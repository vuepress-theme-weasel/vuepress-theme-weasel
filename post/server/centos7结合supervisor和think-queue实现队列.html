<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.45">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2410206_mfj6e1vbwo.css"><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5594713079666864" async crossorigin="anonymous"></script><title>centos7结合supervisor和think-queue实现队列 | CavinHuangNote笔记</title><meta name="description" content="愿世界和平！">
    <link rel="modulepreload" href="/assets/app.f3af98d4.js"><link rel="modulepreload" href="/assets/centos7结合supervisor和think-queue实现队列.html.15a6a6bb.js"><link rel="modulepreload" href="/assets/centos7结合supervisor和think-queue实现队列.html.c6907367.js"><link rel="prefetch" href="/assets/index.html.4c011c28.js"><link rel="prefetch" href="/assets/about-me.html.5532dd95.js"><link rel="prefetch" href="/assets/home.html.6671f543.js"><link rel="prefetch" href="/assets/index.html.6ddd81c3.js"><link rel="prefetch" href="/assets/index.html.14de1a45.js"><link rel="prefetch" href="/assets/index.html.5ce0082d.js"><link rel="prefetch" href="/assets/container.html.3b28d365.js"><link rel="prefetch" href="/assets/disable.html.91484041.js"><link rel="prefetch" href="/assets/encrypt.html.cf8ccf83.js"><link rel="prefetch" href="/assets/markdown.html.6b3bfa00.js"><link rel="prefetch" href="/assets/page.html.1d41d2c2.js"><link rel="prefetch" href="/assets/index.html.d301c6a4.js"><link rel="prefetch" href="/assets/index.html.43102be7.js"><link rel="prefetch" href="/assets/mysql创建远程用户并授权.html.947a7e25.js"><link rel="prefetch" href="/assets/mysql密码修改，创建远程用户记录.html.a2ea3e4f.js"><link rel="prefetch" href="/assets/ngnix笔记.html.2e6e37e0.js"><link rel="prefetch" href="/assets/index.html.b444d880.js"><link rel="prefetch" href="/assets/Vite_React 组件开发实践.html.d2e6c149.js"><link rel="prefetch" href="/assets/使用pnpm构建Monorepo项目.html.f268efd4.js"><link rel="prefetch" href="/assets/index.html.3c9daa97.js"><link rel="prefetch" href="/assets/blob类型的数据转换成json数据.html.773e7a1e.js"><link rel="prefetch" href="/assets/index.html.0011a955.js"><link rel="prefetch" href="/assets/CentOS7安装iptables防火墙.html.59c0d1da.js"><link rel="prefetch" href="/assets/Centos7硬盘挂载方法.html.e4e31eed.js"><link rel="prefetch" href="/assets/Linux创建用户只能访问某个目录.html.7525c484.js"><link rel="prefetch" href="/assets/Linux的cron和crontab.html.666b0cbe.js"><link rel="prefetch" href="/assets/index.html.55ad8ded.js"><link rel="prefetch" href="/assets/centos7安装和php7.1 redis扩展.html.c30ff1ef.js"><link rel="prefetch" href="/assets/linux-centos-7-下安装nginx1-13-php7-0环境.html.12103a5d.js"><link rel="prefetch" href="/assets/linux-composer-安装.html.bbb82e20.js"><link rel="prefetch" href="/assets/linux增加ssh-key到authorized-keys.html.0af38b6c.js"><link rel="prefetch" href="/assets/linux操作记录.html.546a2de9.js"><link rel="prefetch" href="/assets/index.html.0c9eabd9.js"><link rel="prefetch" href="/assets/index.html.80f62ea3.js"><link rel="prefetch" href="/assets/demo.html.b2caec65.js"><link rel="prefetch" href="/assets/implement-a-koa-starter-from-scratch-1.html.dd7750a9.js"><link rel="prefetch" href="/assets/implement-a-koa-starter-from-scratch-2.html.be54e9b7.js"><link rel="prefetch" href="/assets/implement-a-koa-starter-from-scratch-3.html.cea91c80.js"><link rel="prefetch" href="/assets/node-request.html.2c606273.js"><link rel="prefetch" href="/assets/index.html.afbf392f.js"><link rel="prefetch" href="/assets/php-SplStack.html.e02bd38f.js"><link rel="prefetch" href="/assets/php-empty.html.1ac63010.js"><link rel="prefetch" href="/assets/php-fpm-actions.html.3ecc9e69.js"><link rel="prefetch" href="/assets/php知识梳理系列-数组.html.36e030d6.js"><link rel="prefetch" href="/assets/php计算两个经纬度地点之间的距离.html.64edf6bf.js"><link rel="prefetch" href="/assets/index.html.35b0391b.js"><link rel="prefetch" href="/assets/createApp创建过程解析.html.1d54ace6.js"><link rel="prefetch" href="/assets/index.html.cbe844c7.js"><link rel="prefetch" href="/assets/vue自定义指令的jsx语法.html.483deaea.js"><link rel="prefetch" href="/assets/实用的vue指令结合(持续更新).html.db5ef30f.js"><link rel="prefetch" href="/assets/index.html.c3e6084b.js"><link rel="prefetch" href="/assets/normal.html.598adf47.js"><link rel="prefetch" href="/assets/vue.html.37f9df0b.js"><link rel="prefetch" href="/assets/index.html.ae0b8726.js"><link rel="prefetch" href="/assets/nature.html.b205917a.js"><link rel="prefetch" href="/assets/object.html.8e8fb238.js"><link rel="prefetch" href="/assets/people.html.fa72073b.js"><link rel="prefetch" href="/assets/place.html.038f9d67.js"><link rel="prefetch" href="/assets/symbol.html.36786a2a.js"><link rel="prefetch" href="/assets/404.html.c27e39d7.js"><link rel="prefetch" href="/assets/index.html.b24ffa1f.js"><link rel="prefetch" href="/assets/index.html.0bc5739a.js"><link rel="prefetch" href="/assets/index.html.20b7cf3a.js"><link rel="prefetch" href="/assets/index.html.56c9b9ff.js"><link rel="prefetch" href="/assets/index.html.4e28a055.js"><link rel="prefetch" href="/assets/index.html.794fee9a.js"><link rel="prefetch" href="/assets/index.html.044caca5.js"><link rel="prefetch" href="/assets/index.html.50e992dc.js"><link rel="prefetch" href="/assets/index.html.670c4143.js"><link rel="prefetch" href="/assets/index.html.bf5c0309.js"><link rel="prefetch" href="/assets/index.html.52ab8e61.js"><link rel="prefetch" href="/assets/index.html.a54ed6a6.js"><link rel="prefetch" href="/assets/index.html.6b53e4c5.js"><link rel="prefetch" href="/assets/index.html.735f6134.js"><link rel="prefetch" href="/assets/index.html.410746e5.js"><link rel="prefetch" href="/assets/index.html.95f78b87.js"><link rel="prefetch" href="/assets/index.html.dae55f4c.js"><link rel="prefetch" href="/assets/index.html.cc92fc76.js"><link rel="prefetch" href="/assets/index.html.202942b5.js"><link rel="prefetch" href="/assets/index.html.a0825fd1.js"><link rel="prefetch" href="/assets/index.html.8e7e293a.js"><link rel="prefetch" href="/assets/index.html.0e28deff.js"><link rel="prefetch" href="/assets/index.html.298b5e0f.js"><link rel="prefetch" href="/assets/index.html.ec02c558.js"><link rel="prefetch" href="/assets/index.html.74b76fa1.js"><link rel="prefetch" href="/assets/index.html.a6c00e32.js"><link rel="prefetch" href="/assets/index.html.ab6b76dd.js"><link rel="prefetch" href="/assets/index.html.47abf92e.js"><link rel="prefetch" href="/assets/index.html.d13b2b72.js"><link rel="prefetch" href="/assets/index.html.d65196c1.js"><link rel="prefetch" href="/assets/index.html.ceac0753.js"><link rel="prefetch" href="/assets/index.html.494d9304.js"><link rel="prefetch" href="/assets/index.html.162c70d9.js"><link rel="prefetch" href="/assets/index.html.ebaa9864.js"><link rel="prefetch" href="/assets/index.html.25b80492.js"><link rel="prefetch" href="/assets/index.html.d18903cd.js"><link rel="prefetch" href="/assets/index.html.45bde9ac.js"><link rel="prefetch" href="/assets/index.html.8f39c3da.js"><link rel="prefetch" href="/assets/index.html.c4ca163e.js"><link rel="prefetch" href="/assets/index.html.3b1793d8.js"><link rel="prefetch" href="/assets/index.html.ea7e6b50.js"><link rel="prefetch" href="/assets/index.html.23c570d5.js"><link rel="prefetch" href="/assets/index.html.7cdc8f98.js"><link rel="prefetch" href="/assets/index.html.07929606.js"><link rel="prefetch" href="/assets/index.html.15762ff7.js"><link rel="prefetch" href="/assets/index.html.720a7b7d.js"><link rel="prefetch" href="/assets/index.html.efec37d0.js"><link rel="prefetch" href="/assets/index.html.01043fda.js"><link rel="prefetch" href="/assets/index.html.d1e8ee10.js"><link rel="prefetch" href="/assets/index.html.ff02d476.js"><link rel="prefetch" href="/assets/index.html.04cccc03.js"><link rel="prefetch" href="/assets/index.html.596cc601.js"><link rel="prefetch" href="/assets/index.html.b9288a27.js"><link rel="prefetch" href="/assets/index.html.c7defb82.js"><link rel="prefetch" href="/assets/index.html.a827abcc.js"><link rel="prefetch" href="/assets/index.html.71e0cbea.js"><link rel="prefetch" href="/assets/index.html.4e68115c.js"><link rel="prefetch" href="/assets/index.html.598244f8.js"><link rel="prefetch" href="/assets/index.html.3b154a2f.js"><link rel="prefetch" href="/assets/index.html.da95597c.js"><link rel="prefetch" href="/assets/index.html.5c159bfe.js"><link rel="prefetch" href="/assets/index.html.452aeded.js"><link rel="prefetch" href="/assets/index.html.8358c182.js"><link rel="prefetch" href="/assets/index.html.777b715e.js"><link rel="prefetch" href="/assets/index.html.3f7edb3a.js"><link rel="prefetch" href="/assets/index.html.d632748a.js"><link rel="prefetch" href="/assets/index.html.37f7a286.js"><link rel="prefetch" href="/assets/index.html.93ea512d.js"><link rel="prefetch" href="/assets/index.html.79a1ee4c.js"><link rel="prefetch" href="/assets/index.html.36c0db96.js"><link rel="prefetch" href="/assets/index.html.7b6bcae3.js"><link rel="prefetch" href="/assets/index.html.c35ad171.js"><link rel="prefetch" href="/assets/index.html.1b8a7401.js"><link rel="prefetch" href="/assets/index.html.90403c53.js"><link rel="prefetch" href="/assets/index.html.6429a440.js"><link rel="prefetch" href="/assets/index.html.f904783c.js"><link rel="prefetch" href="/assets/index.html.784928f7.js"><link rel="prefetch" href="/assets/index.html.d26f058e.js"><link rel="prefetch" href="/assets/index.html.bbe9f019.js"><link rel="prefetch" href="/assets/about-me.html.0a181bfc.js"><link rel="prefetch" href="/assets/home.html.556216b3.js"><link rel="prefetch" href="/assets/index.html.3cdaecdf.js"><link rel="prefetch" href="/assets/index.html.50343843.js"><link rel="prefetch" href="/assets/index.html.255f6f83.js"><link rel="prefetch" href="/assets/container.html.651875ba.js"><link rel="prefetch" href="/assets/disable.html.9236cfe5.js"><link rel="prefetch" href="/assets/encrypt.html.89ac6cca.js"><link rel="prefetch" href="/assets/markdown.html.2be5f707.js"><link rel="prefetch" href="/assets/page.html.4cc9cacd.js"><link rel="prefetch" href="/assets/index.html.88352a67.js"><link rel="prefetch" href="/assets/index.html.2759b3e9.js"><link rel="prefetch" href="/assets/mysql创建远程用户并授权.html.dbcbba7d.js"><link rel="prefetch" href="/assets/mysql密码修改，创建远程用户记录.html.d0d2fd89.js"><link rel="prefetch" href="/assets/ngnix笔记.html.e7f3fcb9.js"><link rel="prefetch" href="/assets/index.html.145b7b2a.js"><link rel="prefetch" href="/assets/Vite_React 组件开发实践.html.ffc81e2b.js"><link rel="prefetch" href="/assets/使用pnpm构建Monorepo项目.html.81430ff1.js"><link rel="prefetch" href="/assets/index.html.e576ac62.js"><link rel="prefetch" href="/assets/blob类型的数据转换成json数据.html.a2a0c545.js"><link rel="prefetch" href="/assets/index.html.a3bb866c.js"><link rel="prefetch" href="/assets/CentOS7安装iptables防火墙.html.bfe927ac.js"><link rel="prefetch" href="/assets/Centos7硬盘挂载方法.html.c6cea53a.js"><link rel="prefetch" href="/assets/Linux创建用户只能访问某个目录.html.9729f8c9.js"><link rel="prefetch" href="/assets/Linux的cron和crontab.html.c6bfc046.js"><link rel="prefetch" href="/assets/index.html.ee4b7bc7.js"><link rel="prefetch" href="/assets/centos7安装和php7.1 redis扩展.html.d3859ada.js"><link rel="prefetch" href="/assets/linux-centos-7-下安装nginx1-13-php7-0环境.html.c3ea29f9.js"><link rel="prefetch" href="/assets/linux-composer-安装.html.48de1460.js"><link rel="prefetch" href="/assets/linux增加ssh-key到authorized-keys.html.fdd0497a.js"><link rel="prefetch" href="/assets/linux操作记录.html.1ac32213.js"><link rel="prefetch" href="/assets/index.html.d5e6a60a.js"><link rel="prefetch" href="/assets/index.html.ced64d50.js"><link rel="prefetch" href="/assets/demo.html.8e818628.js"><link rel="prefetch" href="/assets/implement-a-koa-starter-from-scratch-1.html.7e5f34c9.js"><link rel="prefetch" href="/assets/implement-a-koa-starter-from-scratch-2.html.2862a022.js"><link rel="prefetch" href="/assets/implement-a-koa-starter-from-scratch-3.html.31377471.js"><link rel="prefetch" href="/assets/node-request.html.8aaccaac.js"><link rel="prefetch" href="/assets/index.html.a8810bed.js"><link rel="prefetch" href="/assets/php-SplStack.html.643588c7.js"><link rel="prefetch" href="/assets/php-empty.html.92d9e33a.js"><link rel="prefetch" href="/assets/php-fpm-actions.html.2cad6f84.js"><link rel="prefetch" href="/assets/php知识梳理系列-数组.html.28312cd2.js"><link rel="prefetch" href="/assets/php计算两个经纬度地点之间的距离.html.780ff90c.js"><link rel="prefetch" href="/assets/index.html.5d062e62.js"><link rel="prefetch" href="/assets/createApp创建过程解析.html.396e009b.js"><link rel="prefetch" href="/assets/index.html.6ea130db.js"><link rel="prefetch" href="/assets/vue自定义指令的jsx语法.html.5154375c.js"><link rel="prefetch" href="/assets/实用的vue指令结合(持续更新).html.160a4fe9.js"><link rel="prefetch" href="/assets/index.html.fa1db7b6.js"><link rel="prefetch" href="/assets/normal.html.ffe2b992.js"><link rel="prefetch" href="/assets/vue.html.ab80b5f7.js"><link rel="prefetch" href="/assets/index.html.768474e4.js"><link rel="prefetch" href="/assets/nature.html.dca6fd98.js"><link rel="prefetch" href="/assets/object.html.ced6657c.js"><link rel="prefetch" href="/assets/people.html.42a303a3.js"><link rel="prefetch" href="/assets/place.html.64f997f2.js"><link rel="prefetch" href="/assets/symbol.html.2bba83db.js"><link rel="prefetch" href="/assets/404.html.517e4e80.js"><link rel="prefetch" href="/assets/index.html.960ea048.js"><link rel="prefetch" href="/assets/index.html.e69d9c6e.js"><link rel="prefetch" href="/assets/index.html.2d503c5d.js"><link rel="prefetch" href="/assets/index.html.333f87a5.js"><link rel="prefetch" href="/assets/index.html.abea471f.js"><link rel="prefetch" href="/assets/index.html.f5677255.js"><link rel="prefetch" href="/assets/index.html.de835148.js"><link rel="prefetch" href="/assets/index.html.50b095e2.js"><link rel="prefetch" href="/assets/index.html.2db42065.js"><link rel="prefetch" href="/assets/index.html.a4c7528b.js"><link rel="prefetch" href="/assets/index.html.8405f826.js"><link rel="prefetch" href="/assets/index.html.ecce1f1f.js"><link rel="prefetch" href="/assets/index.html.c98d136b.js"><link rel="prefetch" href="/assets/index.html.d56c2afb.js"><link rel="prefetch" href="/assets/index.html.6c5a4376.js"><link rel="prefetch" href="/assets/index.html.67d2cca8.js"><link rel="prefetch" href="/assets/index.html.f521735f.js"><link rel="prefetch" href="/assets/index.html.3d6baaf5.js"><link rel="prefetch" href="/assets/index.html.4ae6564f.js"><link rel="prefetch" href="/assets/index.html.d53325b1.js"><link rel="prefetch" href="/assets/index.html.67fca712.js"><link rel="prefetch" href="/assets/index.html.5f3f4500.js"><link rel="prefetch" href="/assets/index.html.c73b3638.js"><link rel="prefetch" href="/assets/index.html.f1b50fa4.js"><link rel="prefetch" href="/assets/index.html.a52a571f.js"><link rel="prefetch" href="/assets/index.html.9fd90fac.js"><link rel="prefetch" href="/assets/index.html.037f7b75.js"><link rel="prefetch" href="/assets/index.html.df17b291.js"><link rel="prefetch" href="/assets/index.html.dc2d1a4c.js"><link rel="prefetch" href="/assets/index.html.12a605c9.js"><link rel="prefetch" href="/assets/index.html.d3f4bd6c.js"><link rel="prefetch" href="/assets/index.html.cf2e66bf.js"><link rel="prefetch" href="/assets/index.html.d12dccea.js"><link rel="prefetch" href="/assets/index.html.fd3c11f8.js"><link rel="prefetch" href="/assets/index.html.6ab96f54.js"><link rel="prefetch" href="/assets/index.html.c760a9be.js"><link rel="prefetch" href="/assets/index.html.3635cdcf.js"><link rel="prefetch" href="/assets/index.html.2addb0e2.js"><link rel="prefetch" href="/assets/index.html.756f9aab.js"><link rel="prefetch" href="/assets/index.html.d11b91f3.js"><link rel="prefetch" href="/assets/index.html.56bb3876.js"><link rel="prefetch" href="/assets/index.html.b4ae1c5d.js"><link rel="prefetch" href="/assets/index.html.f5c1134c.js"><link rel="prefetch" href="/assets/index.html.715895a7.js"><link rel="prefetch" href="/assets/index.html.584100cd.js"><link rel="prefetch" href="/assets/index.html.d59e2f17.js"><link rel="prefetch" href="/assets/index.html.fea402b9.js"><link rel="prefetch" href="/assets/index.html.3385f40a.js"><link rel="prefetch" href="/assets/index.html.df5713e9.js"><link rel="prefetch" href="/assets/index.html.aa1851c0.js"><link rel="prefetch" href="/assets/index.html.20ff52c9.js"><link rel="prefetch" href="/assets/index.html.54ce8297.js"><link rel="prefetch" href="/assets/index.html.58b3f31b.js"><link rel="prefetch" href="/assets/index.html.2b21d529.js"><link rel="prefetch" href="/assets/index.html.6ac14aa1.js"><link rel="prefetch" href="/assets/index.html.74108685.js"><link rel="prefetch" href="/assets/index.html.4acdcce4.js"><link rel="prefetch" href="/assets/index.html.62e70fad.js"><link rel="prefetch" href="/assets/index.html.5df0b79d.js"><link rel="prefetch" href="/assets/index.html.c0007f3f.js"><link rel="prefetch" href="/assets/index.html.b23f7994.js"><link rel="prefetch" href="/assets/index.html.dfbbff81.js"><link rel="prefetch" href="/assets/index.html.c3a56da1.js"><link rel="prefetch" href="/assets/index.html.905f1ee2.js"><link rel="prefetch" href="/assets/index.html.2d4f13c3.js"><link rel="prefetch" href="/assets/index.html.93a92cc8.js"><link rel="prefetch" href="/assets/index.html.b901553e.js"><link rel="prefetch" href="/assets/index.html.1bbff9fd.js"><link rel="prefetch" href="/assets/index.html.6a1bd6b6.js"><link rel="prefetch" href="/assets/index.html.5cf44491.js"><link rel="prefetch" href="/assets/index.html.86a0cdb5.js"><link rel="prefetch" href="/assets/index.html.0ccefa66.js"><link rel="prefetch" href="/assets/index.html.a4cf2c01.js"><link rel="prefetch" href="/assets/index.html.83761510.js"><link rel="prefetch" href="/assets/index.html.1a4db708.js"><link rel="prefetch" href="/assets/index.html.d3b94e67.js"><link rel="prefetch" href="/assets/index.html.ce09e80d.js"><link rel="prefetch" href="/assets/index.html.dd54877d.js"><link rel="prefetch" href="/assets/404.48462731.js"><link rel="prefetch" href="/assets/Default.016515d6.js"><link rel="prefetch" href="/assets/Blog.976f113a.js"><link rel="prefetch" href="/assets/giscus.es.f8d62103.js">
    <link rel="stylesheet" href="/assets/style.3bd8f19f.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="page has-toc"><div class="blog-body-container"><!--[--><div class="home-page-container"><header class="header-container"><div class="header-nav"><div class="header-menu-logo">CavinHuangNote笔记</div><div class="header-navbar-wrapper"><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" arialabelledby="outlook"><title id="outlook" lang="en">outlook icon</title><g fill="currentColor"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></g></svg><div class="outlook-dropdown"><!----></div></button></div></div></div><div class="banner-container"><div class="banner-item"><div class="banner-image"><img class="banner-item-image" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg2.niutuku.com%2Fdesk%2F130220%2F17%2F17-niutuku.com-439.jpg&amp;refer=http%3A%2F%2Fimg2.niutuku.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1646980276&amp;t=1f374dacd52026cf93c7c8e80f7a694c" alt="CavinHuangNote笔记"></div></div></div></header><div class="content-container"><div class="nav-bar-container"><div class="nav-logo">CavinHuang</div><div class="nav-bar-wrap"><!--[--><div class="nav-bar__item"><span class="nav-bar__border"></span><span class="nav-bar__border"></span><span class="nav-bar__border"></span><span class="nav-bar__border"></span><h3 class="nav-bar__text">博客首页</h3></div><div class="nav-bar__item"><span class="nav-bar__border"></span><span class="nav-bar__border"></span><span class="nav-bar__border"></span><span class="nav-bar__border"></span><h3 class="nav-bar__text">博客目录</h3></div><div class="nav-bar__item"><span class="nav-bar__border"></span><span class="nav-bar__border"></span><span class="nav-bar__border"></span><span class="nav-bar__border"></span><h3 class="nav-bar__text">图片分享</h3></div><div class="nav-bar__item"><span class="nav-bar__border"></span><span class="nav-bar__border"></span><span class="nav-bar__border"></span><span class="nav-bar__border"></span><h3 class="nav-bar__text">订阅信息</h3></div><!--]--></div></div><div class="blog-page-wrapper"><main class="blog-home"><!--[--><!--[--><div><!--[--><article class="article-page-container" data-v-6491d27a><div class="article-thumb" data-v-6491d27a><div class="article-thumb-wrapper" data-v-6491d27a><img src="/post/server/images/supervisorctl_sh.png" alt="centos7结合supervisor和think-queue实现队列" data-v-6491d27a><svg xmlns="http://www.w3.org/2000/svg" class="icon cover-icon thumb-icon" viewbox="0 0 1024 1024" arialabelledby="cover" data-v-6491d27a><title id="cover" lang="en">cover icon</title><g fill="rgba(255, 255, 255, 0.8)"><path d="M79.189333 112.426667c10.709333-3.925333 856.576-3.584 868.010667 0.896a105.514667 105.514667 0 0 1 59.861333 61.354666c3.925333 10.709333 3.925333 663.936 0 674.645334a105.514667 105.514667 0 0 1-59.861333 61.354666c-11.434667 4.48-857.301333 4.821333-868.010667 0.896a105.557333 105.557333 0 0 1-62.250666-62.250666c-3.925333-10.709333-3.925333-663.936 0-674.645334a105.557333 105.557333 0 0 1 62.250666-62.250666z m868.565334 473.984l-378.922667 178.261333c-2.602667 1.066667-3.242667 1.450667-5.973333 2.133333a32 32 0 0 1-29.397334-7.594666l-189.909333-175.786667-254.677333 119.808-3.114667 1.28c-2.858667 0.810667-3.541333 1.152-6.485333 1.536a64.384 64.384 0 0 1-2.858667 0.213333c0.256 71.168 0.554667 120.917333 0.981333 121.984 4.224 10.666667 13.056 19.285333 23.808 23.253334 4.138667 1.493333 819.370667 0.981333 823.424-0.725334a41.045333 41.045333 0 0 0 22.314667-23.466666c0.64-1.706667 0.896-112.512 0.810667-240.896z m-0.042667-70.613334c-0.213333-158.976-0.896-319.658667-1.877333-321.834666a41.045333 41.045333 0 0 0-24.917334-22.058667C916.949333 170.666667 105.770667 170.837333 101.205333 172.501333a41.088 41.088 0 0 0-24.149333 24.192c-0.981333 2.645333-1.152 256.682667-0.810667 441.728l259.584-122.112a37.504 37.504 0 0 1 9.045334-2.730666 32.426667 32.426667 0 0 1 21.290666 4.394666c2.389333 1.493333 2.858667 2.005333 5.034667 3.797334l189.909333 175.829333 385.28-181.290667 1.322667-0.512z"></path><path d="M809.173333 234.666667c15.786667 0.597333 31.189333 4.096 45.44 10.965333a112.341333 112.341333 0 0 1 54.357334 57.045333 111.061333 111.061333 0 0 1 6.528 65.834667 112.469333 112.469333 0 0 1-63.317334 79.146667 111.104 111.104 0 0 1-86.784 2.133333 111.957333 111.957333 0 0 1-68.821333-84.010667 112.128 112.128 0 0 1-0.469333-36.608 112.256 112.256 0 0 1 54.698666-79.744 113.109333 113.109333 0 0 1 58.368-14.762666zM805.034667 298.666667a47.402667 47.402667 0 1 0 2.474666 94.805333A47.402667 47.402667 0 0 0 805.034667 298.666667z"></path></g></svg></div></div><div class="article-content-container" data-v-6491d27a><div class="article-title" data-v-6491d27a>centos7结合supervisor和think-queue实现队列</div><div class="article-info" data-v-6491d27a><div class="article-author article-info__item" data-v-6491d27a><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" arialabelledby="author" data-v-6491d27a><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><!--[--><span data-v-6491d27a>Mr.Huang</span><!--]--></div><div class="article-date article-info__item" data-v-6491d27a><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" arialabelledby="calendar" data-v-6491d27a><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span data-v-6491d27a>2022年7月8日</span></div></div><div class="article-content-wrapper" data-v-6491d27a><!--[--><!--[--><div class="theme-weasel-content custom" data-v-6491d27a><!--[--><blockquote><p>Linux的后台进程运行有好几种方法，例如nohup，screen等，但是，如果是一个服务程序，要可靠地在后台运行，我们就需要把它做成daemon，最好还能监控进程状态，在意外结束时能自动重启。 supervisor就是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。</p></blockquote><h1 id="安装supervisor" tabindex="-1"><a class="header-anchor" href="#安装supervisor" aria-hidden="true">#</a> 安装supervisor</h1><blockquote><p>【注】 linux环境必须安装 python</p></blockquote><h2 id="_1-获取supervisor包-【https-pypi-python-org-pypi-supervisor】" tabindex="-1"><a class="header-anchor" href="#_1-获取supervisor包-【https-pypi-python-org-pypi-supervisor】" aria-hidden="true">#</a> 1.获取supervisor包：【<a href="https://pypi.python.org/pypi/supervisor%E3%80%91" target="_blank" rel="noopener noreferrer">https://pypi.python.org/pypi/supervisor】<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># wget https://pypi.python.org/packages/80/37/964c0d53cbd328796b1aeb7abea4c0f7b0e8c7197ea9b0b9967b7d004def/supervisor-3.3.1.tar.gz</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-解压supervisor-3-3-1-tar-gz-并安装" tabindex="-1"><a class="header-anchor" href="#_2-解压supervisor-3-3-1-tar-gz-并安装" aria-hidden="true">#</a> 2.解压supervisor-3.3.1.tar.gz 并安装</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># tar zxvf supervisor-3.3.1.tar.gz &amp;&amp; cd supervisor-3.3.1</span>

<span class="token comment"># python setup.py install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【可能报错】：ImportError: No module named setuptools</p><p>【解决办法】：没有setuptools的模块，说明python缺少这个模块，那我们只要安装这个模块即可解决此问题</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># wget http://pypi.python.org/packages/source/s/setuptools/setuptools-0.6c11.tar.gz</span>

<span class="token comment"># tar zxvf setuptools-0.6c11.tar.gz &amp;&amp; cd setuptools-0.6c11</span>

<span class="token comment"># python setup.py build</span>

<span class="token comment"># python setup.py install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-创建supervisor的配置文件" tabindex="-1"><a class="header-anchor" href="#_3-创建supervisor的配置文件" aria-hidden="true">#</a> 3.创建supervisor的配置文件：</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># echo_supervisord_conf &gt; /etc/supervisord.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_4-开启supervisord服务" tabindex="-1"><a class="header-anchor" href="#_4-开启supervisord服务" aria-hidden="true">#</a> 4.开启supervisord服务</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># supervisord -c /etc/supervisord.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_5-更新新的配置到supervisord" tabindex="-1"><a class="header-anchor" href="#_5-更新新的配置到supervisord" aria-hidden="true">#</a> 5.更新新的配置到supervisord</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># supervisorctl update</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_6-重新启动配置中的所有程序" tabindex="-1"><a class="header-anchor" href="#_6-重新启动配置中的所有程序" aria-hidden="true">#</a> 6.重新启动配置中的所有程序</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># supervisorctl reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_7-启动某个进程-program-name-你配置中写的程序名称" tabindex="-1"><a class="header-anchor" href="#_7-启动某个进程-program-name-你配置中写的程序名称" aria-hidden="true">#</a> 7.启动某个进程(program_name=你配置中写的程序名称)</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># supervisorctl start program_name</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-查看正在守候的进程" tabindex="-1"><a class="header-anchor" href="#_8-查看正在守候的进程" aria-hidden="true">#</a> 8.查看正在守候的进程</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># supervisorctl</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_9-重启某一进程-program-name-你配置中写的程序名称" tabindex="-1"><a class="header-anchor" href="#_9-重启某一进程-program-name-你配置中写的程序名称" aria-hidden="true">#</a> 9.重启某一进程 (program_name=你配置中写的程序名称)</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># supervisorctl restart program_name</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_10-停止全部进程" tabindex="-1"><a class="header-anchor" href="#_10-停止全部进程" aria-hidden="true">#</a> 10.停止全部进程</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># supervisorctl stop all</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_11-查看supervisord进程" tabindex="-1"><a class="header-anchor" href="#_11-查看supervisord进程" aria-hidden="true">#</a> 11.查看supervisord进程</h2><p><img src="/assets/supervisorctl_sh.434e4a37.png" alt="进程"></p><hr><blockquote><p>传统的程序执行流程一般是 即时|同步|串行的，在某些场景下，会存在并发低，吞吐量低，响应时间长等问题。在大型系统中，一般会引入消息队列的组件，将流程中部分任务抽离出来放入消息队列，并由专门的消费者作针对性的处理，从而降低系统耦合度，提高系统性能和可用性。 一般来说，可以抽离的任务具有以下的特点：</p></blockquote><ul><li><p>** 允许延后|异步|并行处理 ** （相对于传统的 <strong>即时|同步|串行</strong> 的执行方式）</p><ul><li><strong>允许延后</strong>： 抢购活动时，先快速缓冲有限的参与人数到消息队列，后续再排队处理实际的抢购业务；</li><li><strong>允许异步</strong>： 业务处理过程中的邮件，短信等通知</li><li><strong>允许并行</strong>： 用户支付成功之后，邮件通知，微信通知，短信通知可以由多个不同的消费者并行执行，通知到达的时间不要求先后顺序。</li></ul></li><li><p>** 允许失败和重试 **</p><ul><li>强一致性的业务放入核心流程处理</li><li>无一致性要求或最终一致即可的业务放入队列处理 ** <a href="https://github.com/top-think/think-queue/releases" target="_blank" rel="noopener noreferrer">thinkphp-queue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ** 是thinkphp 官方提供的一个消息队列服务，它支持消息队列的一些基本特性：</li></ul></li><li><p>消息的<strong>发布</strong>，<strong>获取</strong>，<strong>执行</strong>，<strong>删除</strong>，<strong>重发</strong>，<strong>失败处理</strong>，<strong>延迟执行</strong>，<strong>超时控制</strong>等</p></li><li><p>队列的<strong>多队列</strong>， <strong>内存限制</strong> ，<strong>启动</strong>，<strong>停止</strong>，<strong>守护</strong>等</p></li><li><p>消息队列可<strong>降级为同步执行</strong></p></li></ul><p>thinkphp-queue 内置了 <strong>Redis</strong>，<strong>Database</strong>，<strong>Topthink</strong> ，<strong>Sync</strong>这四种驱动。本文主要介绍 thinkphp-queue 结合其内置的 redis 驱动的使用方式和基本原理。</p><p>注1：如无特殊说明，下文中的 &#39;消息&#39; 和 &#39;任务&#39;两个词指代的是同一个概念，即队列中的一个成员。该成员对消息队列而言是其内部保存的消息； 对业务应用而言是一个待执行的任务。请根据语境区分。</p><p>注2：本文编写时(2017-02-15)使用的 thinkphp-queue 的版本号是 v1.1.2 。该版本中部分功能并未全部完成，如 subscribe 模式，以及存在几个bug(稍后会提及)。如有变更，请以官方最新版为准。</p><h3 id="一-代码示例" tabindex="-1"><a class="header-anchor" href="#一-代码示例" aria-hidden="true">#</a> 一 代码示例</h3><p>先通过一段代码，了解一下 thinkphp-queue 的基本使用流程。</p><blockquote><p>目标：</p></blockquote><blockquote><p>在业务控制器中推送一个新消息到一个名为 &#39;helloJobQueue&#39; 的队列中，该消息中包含我们自定义的业务数据，然后，编写一个名为 Hello 的消费者类，并通过命令行去调用该消费者类获取这个消息，拿到定义的数据。</p></blockquote><h1 id="安装-thinkphp-queue" tabindex="-1"><a class="header-anchor" href="#安装-thinkphp-queue" aria-hidden="true">#</a> 安装 thinkphp-queue</h1><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">composer</span> <span class="token function">install</span> thinkphp-queue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="搭建消息队列的存储环境" tabindex="-1"><a class="header-anchor" href="#搭建消息队列的存储环境" aria-hidden="true">#</a> 搭建消息队列的存储环境</h2><ul><li>使用 Redis [<strong>推荐</strong>]</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>安装并启动 Redis 服务
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>使用数据库 [不推荐]</li></ul><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>CREATE TABLE `prefix_jobs` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `queue` varchar(255) NOT NULL,
  `payload` longtext NOT NULL,
  `attempts` tinyint(3) unsigned NOT NULL,
  `reserved` tinyint(3) unsigned NOT NULL,
  `reserved_at` int(10) unsigned DEFAULT NULL,
  `available_at` int(10) unsigned NOT NULL,
  `created_at` int(10) unsigned NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置消息队列的驱动" tabindex="-1"><a class="header-anchor" href="#配置消息队列的驱动" aria-hidden="true">#</a> 配置消息队列的驱动</h2><p>根据选择的存储方式，在 <code>\application\extra\queue.php</code> 这个配置文件中，添加消息队列对应的驱动配置</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code>   <span class="token keyword">return</span> <span class="token punctuation">[</span>
       <span class="token string single-quoted-string">&#39;connector&#39;</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;Redis&#39;</span><span class="token punctuation">,</span>            <span class="token comment">// Redis 驱动</span>
       <span class="token string single-quoted-string">&#39;expire&#39;</span>     <span class="token operator">=&gt;</span> <span class="token number">60</span><span class="token punctuation">,</span>                <span class="token comment">// 任务的过期时间，默认为60秒; 若要禁用，则设置为 null</span>
       <span class="token string single-quoted-string">&#39;default&#39;</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;default&#39;</span><span class="token punctuation">,</span>        <span class="token comment">// 默认的队列名称</span>
       <span class="token string single-quoted-string">&#39;host&#39;</span>       <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span>        <span class="token comment">// redis 主机ip</span>
       <span class="token string single-quoted-string">&#39;port&#39;</span>       <span class="token operator">=&gt;</span> <span class="token number">6379</span><span class="token punctuation">,</span>            <span class="token comment">// redis 端口</span>
       <span class="token string single-quoted-string">&#39;password&#39;</span>   <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span>                <span class="token comment">// redis 密码</span>
       <span class="token string single-quoted-string">&#39;select&#39;</span>     <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>                <span class="token comment">// 使用哪一个 db，默认为 db0</span>
       <span class="token string single-quoted-string">&#39;timeout&#39;</span>    <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>                <span class="token comment">// redis连接的超时时间</span>
       <span class="token string single-quoted-string">&#39;persistent&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>            <span class="token comment">// 是否是长连接</span>

   <span class="token comment">//    &#39;connector&#39; =&gt; &#39;Database&#39;,   // 数据库驱动</span>
   <span class="token comment">//    &#39;expire&#39;    =&gt; 60,           // 任务的过期时间，默认为60秒; 若要禁用，则设置为 null</span>
   <span class="token comment">//    &#39;default&#39;   =&gt; &#39;default&#39;,    // 默认的队列名称</span>
   <span class="token comment">//    &#39;table&#39;     =&gt; &#39;jobs&#39;,       // 存储消息的表名，不带前缀</span>
   <span class="token comment">//    &#39;dsn&#39;       =&gt; [],</span>

   <span class="token comment">//    &#39;connector&#39;   =&gt; &#39;Topthink&#39;,    // ThinkPHP内部的队列通知服务平台 ，本文不作介绍</span>
   <span class="token comment">//    &#39;token&#39;       =&gt; &#39;&#39;,</span>
   <span class="token comment">//    &#39;project_id&#39;  =&gt; &#39;&#39;,</span>
   <span class="token comment">//    &#39;protocol&#39;    =&gt; &#39;https&#39;,</span>
   <span class="token comment">//    &#39;host&#39;        =&gt; &#39;qns.topthink.com&#39;,</span>
   <span class="token comment">//    &#39;port&#39;        =&gt; 443,</span>
   <span class="token comment">//    &#39;api_version&#39; =&gt; 1,</span>
   <span class="token comment">//    &#39;max_retries&#39; =&gt; 3,</span>
   <span class="token comment">//    &#39;default&#39;     =&gt; &#39;default&#39;,</span>

   <span class="token comment">//    &#39;connector&#39;   =&gt; &#39;Sync&#39;,        // Sync 驱动，该驱动的实际作用是取消消息队列，还原为同步执行</span>
   <span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>1.3.1 配置文件中的 expire 参数说明</strong></p><p>expire 参数指的是任务的过期时间。 过期的任务，其准确的定义是</p><ol><li>任务的状态为执行中</li><li>任务的开始执行的时刻 + expire &gt; 当前时刻</li></ol><p>expire 不为<code>null</code> 时 ，thinkphp-queue 会在每次获取下一个任务之前检查并重发过期(执行超时)的任务。</p><p>expire 为<code>null</code> 时，thinkphp-queue 不会检查过期的任务，性能相对较高一点。但是需要注意：</p><ul><li>这些执行超时的任务会一直留在消息队列中，需要开发者另行处理(删除或者重发)！</li><li>[ <strong><a href="https://github.com/top-think/think-queue/issues/12" target="_blank" rel="noopener noreferrer">Bug<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong> ]在redis 驱动下，expire 设置为 null 时，无法实现任务的延迟执行! (Database 驱动下无影响)</li></ul><p><strong>对expire 参数理解或者使用不当时，很容易产生一些bug</strong>，后面会举例提到。</p><h3 id="消息的创建与推送" tabindex="-1"><a class="header-anchor" href="#消息的创建与推送" aria-hidden="true">#</a> 消息的创建与推送</h3><p>我们在业务控制器中创建一个新的消息，并推送到 <code>helloJobQueue</code> 队列</p><p>新增 <code>\application\index\controller\JobTest.php</code> 控制器，在该控制器中添加 <code>actionWithHelloJob</code> 方法</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token doc-comment comment">/**
* 文件路径： \application\index\controller\JobTest.php
* 该控制器的业务代码中借助了thinkphp-queue 库，将一个消息推送到消息队列
*/</span>
<span class="token keyword">namespace</span> <span class="token package">application<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span>
  <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Exception</span><span class="token punctuation">;</span>

  <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Queue</span><span class="token punctuation">;</span>

  <span class="token keyword">class</span> <span class="token class-name-definition class-name">JobTest</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * 一个使用了队列的 action
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">actionWithHelloJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

      <span class="token comment">// 1.当前任务将由哪个类来负责处理。</span>
      <span class="token comment">//   当轮到该任务时，系统将生成一个该类的实例，并调用其 fire 方法</span>
      <span class="token variable">$jobHandlerClassName</span>  <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;application\index\job\Hello&#39;</span><span class="token punctuation">;</span>
      <span class="token comment">// 2.当前任务归属的队列名称，如果为新队列，会自动创建</span>
      <span class="token variable">$jobQueueName</span>        <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;helloJobQueue&quot;</span><span class="token punctuation">;</span>
      <span class="token comment">// 3.当前任务所需的业务数据 . 不能为 resource 类型，其他类型最终将转化为json形式的字符串</span>
      <span class="token comment">//   ( jobData 为对象时，需要在先在此处手动序列化，否则只存储其public属性的键值对)</span>
      <span class="token variable">$jobData</span>             <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">&#39;ts&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;bizId&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;a&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">1</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span>
      <span class="token comment">// 4.将该任务推送到消息队列，等待对应的消费者去执行</span>
      <span class="token variable">$isPushed</span> <span class="token operator">=</span> <span class="token class-name static-context">Queue</span><span class="token operator">::</span><span class="token function">push</span><span class="token punctuation">(</span> <span class="token variable">$jobHandlerClassName</span> <span class="token punctuation">,</span> <span class="token variable">$jobData</span> <span class="token punctuation">,</span> <span class="token variable">$jobQueueName</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// database 驱动时，返回值为 1|false  ;   redis 驱动时，返回值为 随机字符串|false</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$isPushed</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">echo</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;Y-m-d H:i:s&#39;</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; a new Hello Job is Pushed to the MQ&quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;br&gt;&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
          <span class="token keyword">echo</span> <span class="token string single-quoted-string">&#39;Oops, something went wrong.&#39;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意:</strong> 在这个例子当中，我们是手动指定的 <code>$jobHandlerClassName</code> ，更合理的做法是先定义好消息名称与消费者类名的映射关系，然后由某个可以获取该映射关系的类来推送这个消息。这样，生产者只需要知道消息的名称，而无需指定哪个消费者类来处理。</p><blockquote><p>除了 <code>Queue::push( $jobHandlerClassName , $jobData , $jobQueueName );</code>这种方式之外，还可以直接传入 <code>Queue::push( $jobHandlerObject ,null , $jobQueueName );</code> 这时，需要在 $jobHandlerObject 中定义一个 <code>handle()</code> 方法，消息队列在执行到该任务时会自动反序列化该对象，并调用其 <code>handle()</code>方法。 该方式的缺点是无法传入自定义数据。</p></blockquote><h3 id="消息的消费与删除" tabindex="-1"><a class="header-anchor" href="#消息的消费与删除" aria-hidden="true">#</a> 消息的消费与删除</h3><p>编写 Hello 消费者类，用于处理 <code>helloJobQueue</code> 队列中的任务</p><p>新增 <code>\application\index\job\Hello.php</code> 消费者类，并编写其 <code>fire()</code> 方法</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
  <span class="token doc-comment comment">/**
   * 文件路径： \application\index\job\Hello.php
   * 这是一个消费者类，用于处理 helloJobQueue 队列中的任务
   */</span>
  <span class="token keyword">namespace</span> <span class="token package">application<span class="token punctuation">\</span>index<span class="token punctuation">\</span>job</span><span class="token punctuation">;</span>

  <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>queue<span class="token punctuation">\</span>Job</span><span class="token punctuation">;</span>

  <span class="token keyword">class</span> <span class="token class-name-definition class-name">Hello</span> <span class="token punctuation">{</span>

      <span class="token doc-comment comment">/**
       * fire方法是消息队列默认调用的方法
       * <span class="token keyword">@param</span> <span class="token class-name">Job</span>            <span class="token parameter">$job</span>      当前的任务对象
       * <span class="token keyword">@param</span> <span class="token class-name"><span class="token keyword">array</span><span class="token punctuation">|</span><span class="token keyword">mixed</span></span>    <span class="token parameter">$data</span>     发布任务时自定义的数据
       */</span>
      <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">fire</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Job</span> <span class="token variable">$job</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

          <span class="token variable">$isJobDone</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">doHelloJob</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$isJobDone</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">//如果任务执行成功， 记得删除任务</span>
              <span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;&lt;info&gt;Hello Job has been done and deleted&quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/info&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">attempts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">//通过这个方法可以检查这个任务已经重试了几次了</span>
                  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;&lt;warn&gt;Hello Job has been retried more than 3 times!&quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/warn&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token comment">// 也可以重新发布这个任务</span>
                  <span class="token comment">//print(&quot;&lt;info&gt;Hello Job will be availabe again after 2s.&quot;.&quot;&lt;/info&gt;\n&quot;);</span>
                  <span class="token comment">//$job-&gt;release(2); //$delay为延迟时间，表示该任务延迟2秒后再执行</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token doc-comment comment">/**
       * 根据消息中的数据进行实际的业务处理
       * <span class="token keyword">@param</span> <span class="token class-name"><span class="token keyword">array</span><span class="token punctuation">|</span><span class="token keyword">mixed</span></span>    <span class="token parameter">$data</span>     发布任务时自定义的数据
       * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">boolean</span></span>                 任务执行的结果
       */</span>
      <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">doHelloJob</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 根据消息中的数据进行实际的业务处理...</span>

          <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;&lt;info&gt;Hello Job Started. job Data is: &quot;</span><span class="token operator">.</span><span class="token function">var_export</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/info&gt; \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;&lt;info&gt;Hello Job is Fired at &quot;</span> <span class="token operator">.</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;Y-m-d H:i:s&#39;</span><span class="token punctuation">)</span> <span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/info&gt; \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;&lt;info&gt;Hello Job is Done!&quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/info&gt; \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>至此，所有的代码都已准备完毕，在运行消息队列之前，我们先看一下现在的目录结构：</p><h3 id="发布任务" tabindex="-1"><a class="header-anchor" href="#发布任务" aria-hidden="true">#</a> 发布任务</h3><p>在浏览器中访问 <a href="http://your.project.domain/index/job_test/actionWithHelloJob" target="_blank" rel="noopener noreferrer">http://your.project.domain/index/job_test/actionWithHelloJob<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ,可以看到消息推送成功。</p><h3 id="处理任务" tabindex="-1"><a class="header-anchor" href="#处理任务" aria-hidden="true">#</a> 处理任务</h3><p>切换当前终端窗口的目录到项目根目录下，执行</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>php think queue:work --queue helloJobQueue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可以看到执行的结果类似如下:</p><p>至此，我们成功地经历了一个消息的 创建 -&gt; 推送 -&gt; 消费 -&gt; 删除 的基本流程</p><p>下文，将介绍 thinkphp-queue 的详细使用方法。如配置介绍，基本原理，各种特殊情况的处理等</p><h2 id="二-详细介绍" tabindex="-1"><a class="header-anchor" href="#二-详细介绍" aria-hidden="true">#</a> 二 详细介绍</h2><h3 id="_2-1-命令模式" tabindex="-1"><a class="header-anchor" href="#_2-1-命令模式" aria-hidden="true">#</a> 2.1 命令模式</h3><ul><li><p><strong>queue:subscribe 命令</strong> [截至2017-02-15，作者暂未实现该模式，略过]</p></li><li><p><strong>queue:work 命令</strong></p><p>work 命令： 该命令将启动一个 work 进程来处理消息队列。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>php think queue:work --queue helloJobQueue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p><strong>queue:listen 命令</strong></p><p>listen 命令： 该命令将会创建一个 listen 父进程 ，然后由父进程通过 <code>proc_open(‘php think queue:work’)</code> 的方式来创建一个work 子 进程来处理消息队列，且限制该work进程的执行时间。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>php think queue:listen --queue helloJobQueue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h3 id="_2-2-命令行参数" tabindex="-1"><a class="header-anchor" href="#_2-2-命令行参数" aria-hidden="true">#</a> 2.2 命令行参数</h3><ul><li><p>Work 模式</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>php think queue:work <span class="token punctuation">\</span>
--daemon            //是否循环执行，如果不加该参数，则该命令处理完下一个消息就退出
--queue  helloJobQueue  //要处理的队列的名称
--delay  <span class="token number">0</span> <span class="token punctuation">\</span>        //如果本次任务执行抛出异常且任务未被删除时，设置其下次执行前延迟多少秒,默认为0
--force  <span class="token punctuation">\</span>          //系统处于维护状态时是否仍然处理任务，并未找到相关说明
--memory <span class="token number">128</span> <span class="token punctuation">\</span>      //该进程允许使用的内存上限，以 M 为单位
--sleep  <span class="token number">3</span> <span class="token punctuation">\</span>        //如果队列中无任务，则sleep多少秒后重新检查<span class="token punctuation">(</span>work+daemon模式<span class="token punctuation">)</span>或者退出<span class="token punctuation">(</span>listen或非daemon模式<span class="token punctuation">)</span>
--tries  <span class="token number">2</span>          //如果任务已经超过尝试次数上限，则触发‘任务尝试次数超限’事件，默认为0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Listen 模式</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>php think queue:listen <span class="token punctuation">\</span>
--queue  helloJobQueue <span class="token punctuation">\</span>   //监听的队列的名称
--delay  <span class="token number">0</span> <span class="token punctuation">\</span>         //如果本次任务执行抛出异常且任务未被删除时，设置其下次执行前延迟多少秒,默认为0
--memory <span class="token number">128</span> <span class="token punctuation">\</span>       //该进程允许使用的内存上限，以 M 为单位
--sleep  <span class="token number">3</span> <span class="token punctuation">\</span>         //如果队列中无任务，则多长时间后重新检查，daemon模式下有效
--tries  <span class="token number">0</span> <span class="token punctuation">\</span>         //如果任务已经超过重发次数上限，则进入失败处理逻辑，默认为0
--timeout <span class="token number">60</span>         //创建的work子进程的允许执行的最长时间，以秒为单位
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到 listen 模式下，不包含 <code>--deamon</code> 参数，原因下面会说明</p></li></ul><h3 id="_2-3-work-模式和-listen-模式的区别" tabindex="-1"><a class="header-anchor" href="#_2-3-work-模式和-listen-模式的区别" aria-hidden="true">#</a> 2.3 work 模式和 listen 模式的区别</h3><p>两者都可以用于处理消息队列中的任务区别在于:</p><ul><li><p>2.3.1 执行原理不同**</p><ul><li>work 命令是<strong>单进程</strong>的处理模式。 按照是否设置了 <code>--daemon</code> 参数，work命令又可分为单次执行和循环执行两种模式。 单次执行：不添加 <code>--daemon</code>参数，该模式下,work进程在处理完下一个消息后直接结束当前进程。当不存在新消息时，会sleep一段时间然后退出。 循环执行：添加了 <code>--daemon</code>参数，该模式下,work进程会循环地处理队列中的消息，直到内存超出参数配置才结束进程。当不存在新消息时，会在每次循环中sleep一段时间。</li><li>listen 命令是 <strong>父进程 + 子进程</strong> 的处理模式。 listen命令所在的父进程会创建一个<strong>单次执行模式的work子进程</strong>，并通过该work子进程来处理队列中的下一个消息，当这个work子进程退出之后，listen命令所在的父进程会监听到该子进程的退出信号，并重新创建一个新的<strong>单次执行的work子进程</strong></li></ul></li><li><p>2.3.2 退出时机不同**</p><ul><li>work 命令的退出时机在上面的执行原理部分已叙述，此处不再重复</li><li>listen 命令中，listen所在的父进程正常情况会一直运行，除非遇到下面两种情况： 创建的某个work子进程的执行时间超过了 listen命令行中的<code>--timeout</code> 参数配置，此时work子进程会被强制结束，listen所在的父进程也会抛出一个 <code>ProcessTimeoutException</code> 异常并退出。开发者可以选择捕获该异常，让父进程继续执行，也可以选择通过 supervisor 等监控软件重启一个新的listen命令。 listen 命令所在的父进程因某种原因存在内存泄露，则当父进程本身占用的内存超过了命令行中的 <code>--memory</code> 参数配置时，父子进程均会退出。正常情况下，listen进程本身占用的内存是稳定不变的。</li></ul></li><li><p>2.3.3 性能不同**</p><ul><li>work 命令是在脚本内部做循环，框架脚本在命令执行的初期就已加载完毕；</li><li>而listen模式则是处理完一个任务之后新开一个work进程，此时会重新加载框架脚本。 因此： <strong>work 模式的性能会比listen模式高</strong>。 注意：当代码有更新时，work 模式下需要手动去执行 <code>php think queue:restart</code> 命令重启队列来使改动生效；而listen 模式会自动生效,无需其他操作。</li></ul></li><li><p><strong>2.3.4 超时控制能力</strong></p><ul><li>work 模式本质上既不能控制进程自身的运行时间，也无法限制执行中的任务的执行时间。 举例来说，假如你在某次上线之后，在上文中的 <code>\application\index\job\Hello.php</code> 消费者的<code>fire</code>方法中添加了一段死循环 ：<div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//死循环</span>
       <span class="token variable">$consoleOutPut</span><span class="token operator">-&gt;</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;&lt;info&gt;I am looping forever inside a job.&lt;/info&gt; \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>那么这个循环将永远不能停止，直到任务所在的进程超过内存限制或者由管理员手动结束。这个过程不会有任何的告警。更严重的是，如果你配置了expire ，那么这个死循环的任务可能会污染到同样处理 <code>helloJobQueue</code> 队列的其他work进程，最后好几个work进程将被卡死在这段死循环中。详情后文会说明。 <strong>work 模式下的超时控制能力，实际上应该理解为 多个work 进程配合下的过期任务重发能力。</strong></li><li>而 listen命令可以限制其创建的work子进程的超时时间。 listen 命令可通过 <code>--timeout</code> 参数限制work子进程允许运行的最长时间，超过该时间限制仍未结束的子进程会被强制结束；</li><li>这里有必要补充一下 expire 和 timeout 之间的区别： expire 在配置文件中设置，timeout 在 listen命令 的命令行参数中设置，而且，expire 和 timeout 是两个不同层次上的概念：</li></ul></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- expire 是指任务的过期时间。这个时间是全局的，影响到所有的work进程。(不管是独立的work命令还是 listen 模式下创建的的work子进程) 。expire 针对的对象是 **任务**。
- timeout 是指work子进程的超时时间。这个时间只对当前执行的listen 命令有效。timeout 针对的对象是 **work子进程**。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>2.3.5 使用场景不同</strong> 根据上面的介绍，可以看到， work 命令的适用场景是：</p><ul><li>任务数量较多</li><li>性能要求较高</li><li>任务的执行时间较短</li><li>消费者类中不存在死循环，sleep() ，exit() ,die() 等容易导致bug的逻辑</li></ul><p>listen命令的适用场景是：</p><ul><li>任务数量较少</li><li>任务的执行时间较长(如生成大型的excel报表等)，</li><li>任务的执行时间需要有严格限制</li></ul></li></ul><h3 id="_2-4-消息队列的开始-停止与重启" tabindex="-1"><a class="header-anchor" href="#_2-4-消息队列的开始-停止与重启" aria-hidden="true">#</a> 2.4 消息队列的开始，停止与重启</h3><h4 id="开始一个消息队列" tabindex="-1"><a class="header-anchor" href="#开始一个消息队列" aria-hidden="true">#</a> 开始一个消息队列：</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>php think queue:work
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="停止所有的消息队列" tabindex="-1"><a class="header-anchor" href="#停止所有的消息队列" aria-hidden="true">#</a> 停止所有的消息队列：</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>php think queue:restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="重启所有的消息队列" tabindex="-1"><a class="header-anchor" href="#重启所有的消息队列" aria-hidden="true">#</a> 重启所有的消息队列：</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>php think queue:restart
php think queue:work
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-多模块-多任务的处理" tabindex="-1"><a class="header-anchor" href="#_2-5-多模块-多任务的处理" aria-hidden="true">#</a> 2.5 多模块，多任务的处理</h3><h4 id="多模块" tabindex="-1"><a class="header-anchor" href="#多模块" aria-hidden="true">#</a> 多模块</h4><blockquote><p>单模块项目推荐使用 <code>app\job</code> 作为任务类的命名空间</p></blockquote><blockquote><p>多模块项目可用使用 <code>app\module\job</code> 作为任务类的命名空间 也可以放在任意可以自动加载到的地方</p></blockquote><h4 id="多任务" tabindex="-1"><a class="header-anchor" href="#多任务" aria-hidden="true">#</a> 多任务</h4><blockquote><p>如果一个任务类里有多个小任务的话，在发布任务时，需要用 <code>任务的类名@方法名</code> 如 <code>app\lib\job\Job2@task1</code>、<code>app\lib\job\Job2@task2</code></p></blockquote><blockquote><p>注意：命令行中的 --queue 参数不支持@解析</p></blockquote><p>多任务例子: 在 <code>\application\index\controller\JobTest.php</code> 控制器中，添加 <code>actionWithMultiTask()</code>方法：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">actionWithMultiTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token variable">$taskType</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;taskType&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$whichTask</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">case</span> <span class="token string single-quoted-string">&#39;taskA&#39;</span><span class="token punctuation">:</span>
           <span class="token variable">$jobHandlerClassName</span>  <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;application\index\job\MultiTask@taskA&#39;</span><span class="token punctuation">;</span>
           <span class="token variable">$jobDataArr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;a&#39;</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;1&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
           <span class="token variable">$jobQueueName</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;multiTaskJobQueue&quot;</span><span class="token punctuation">;</span>
           <span class="token keyword">break</span><span class="token punctuation">;</span>
       <span class="token keyword">case</span> <span class="token string single-quoted-string">&#39;taskB&#39;</span><span class="token punctuation">:</span>
           <span class="token variable">$jobHandlerClassName</span>  <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;application\index\job\MultiTask@taskB&#39;</span><span class="token punctuation">;</span>
           <span class="token variable">$jobDataArr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;b&#39;</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;2&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
           <span class="token variable">$jobQueueName</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;multiTaskJobQueue&quot;</span><span class="token punctuation">;</span>
           <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
           <span class="token keyword">break</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

  <span class="token variable">$isPushed</span> <span class="token operator">=</span> <span class="token class-name static-context">Queue</span><span class="token operator">::</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token variable">$jobHandlerClassName</span><span class="token punctuation">,</span> <span class="token variable">$jobDataArr</span><span class="token punctuation">,</span> <span class="token variable">$jobQueueName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$isPushed</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;the <span class="token interpolation"><span class="token variable">$taskType</span></span> of MultiTask Job has been Pushed to &quot;</span><span class="token operator">.</span><span class="token variable">$jobQueueName</span> <span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;br&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;push a new <span class="token interpolation"><span class="token variable">$taskType</span></span> of MultiTask Job Failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>新增 <code>\application\index\job\MultiTask.php</code> 消费者类，并编写其 <code>taskA()</code> 和 <code>taskB()</code>方法</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token doc-comment comment">/**
 * 文件路径： \application\index\job\MultiTask.php
 * 这是一个消费者类，用于处理 multiTaskJobQueue 队列中的任务
 */</span>
<span class="token keyword">namespace</span> <span class="token package">application<span class="token punctuation">\</span>index<span class="token punctuation">\</span>job</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>queue<span class="token punctuation">\</span>Job</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">MultiTask</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">taskA</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Job</span> <span class="token variable">$job</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token variable">$isJobDone</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">_doTaskA</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$isJobDone</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Info: TaskA of Job MultiTask has been done and deleted&quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">attempts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">taskB</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Job</span> <span class="token variable">$job</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token variable">$isJobDone</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">_doTaskA</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$isJobDone</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Info: TaskB of Job MultiTask has been done and deleted&quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">attempts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">_doTaskA</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Info: doing TaskA of Job MultiTask &quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">_doTaskB</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Info: doing TaskB of Job MultiTask &quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-消息的延迟执行与定时执行" tabindex="-1"><a class="header-anchor" href="#_2-6-消息的延迟执行与定时执行" aria-hidden="true">#</a> 2.6 消息的延迟执行与定时执行</h3><p>延迟执行，相对于即时执行，是用来限制某个任务的最早可执行时刻。在到达该时刻之前，该任务会被跳过。</p><p>可以利用该功能实现<strong>定时任务</strong>。</p><p>使用方式：</p><h4 id="在生产者业务代码中" tabindex="-1"><a class="header-anchor" href="#在生产者业务代码中" aria-hidden="true">#</a> 在生产者业务代码中：</h4><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// 即时执行</span>
<span class="token variable">$isPushed</span> <span class="token operator">=</span> <span class="token class-name static-context">Queue</span><span class="token operator">::</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token variable">$jobHandlerClassName</span><span class="token punctuation">,</span> <span class="token variable">$jobDataArr</span><span class="token punctuation">,</span> <span class="token variable">$jobQueueName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 延迟 2 秒执行</span>
<span class="token variable">$isPushed</span> <span class="token operator">=</span> <span class="token class-name static-context">Queue</span><span class="token operator">::</span><span class="token function">later</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token variable">$jobHandlerClassName</span><span class="token punctuation">,</span> <span class="token variable">$jobDataArr</span><span class="token punctuation">,</span> <span class="token variable">$jobQueueName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 延迟到 2017-02-18 01:01:01 时刻执行</span>
<span class="token variable">$time2wait</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;2017-02-18 01:01:01&#39;</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;now&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$isPushed</span> <span class="token operator">=</span> <span class="token class-name static-context">Queue</span><span class="token operator">::</span><span class="token function">later</span><span class="token punctuation">(</span><span class="token variable">$time2wait</span><span class="token punctuation">,</span><span class="token variable">$jobHandlerClassName</span><span class="token punctuation">,</span> <span class="token variable">$jobDataArr</span><span class="token punctuation">,</span> <span class="token variable">$jobQueueName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="在消费者类中" tabindex="-1"><a class="header-anchor" href="#在消费者类中" aria-hidden="true">#</a> 在消费者类中：</h4><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// 重发，即时执行</span>
<span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 重发，延迟 2 秒执行</span>
<span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 延迟到 2017-02-18 01:01:01 时刻执行</span>
<span class="token variable">$time2wait</span> <span class="token operator">=</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;2017-02-18 01:01:01&#39;</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;now&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token variable">$time2wait</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="在命令行中" tabindex="-1"><a class="header-anchor" href="#在命令行中" aria-hidden="true">#</a> 在命令行中：</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>//如果消费者类的fire<span class="token punctuation">(</span><span class="token punctuation">)</span>方法抛出了异常且任务未被删除时，将自动重发该任务，重发时，会设置其下次执行前延迟多少秒,默认为0
php think queue:work --delay <span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-7-消息的重发" tabindex="-1"><a class="header-anchor" href="#_2-7-消息的重发" aria-hidden="true">#</a> 2.7 消息的重发</h3><p>thinkphp-queue 中，消息的重发时机有3种：</p><h4 id="_2-7-1-在消费者类中手动重发" tabindex="-1"><a class="header-anchor" href="#_2-7-1-在消费者类中手动重发" aria-hidden="true">#</a> 2.7.1 在消费者类中手动重发：</h4><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$isJobDone</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-7-2-work进程自动重发-需同时满足以下两个条件" tabindex="-1"><a class="header-anchor" href="#_2-7-2-work进程自动重发-需同时满足以下两个条件" aria-hidden="true">#</a> 2.7.2 work进程自动重发，需同时满足以下两个条件</h4><ul><li>消费者类的 fire() 方法抛出了异常</li><li>任务未被删除</li></ul><h4 id="_2-7-3-当配置了-expire-不为-null-时-work-进程内部每次查询可用任务之前-会先自动重发已过期的任务。" tabindex="-1"><a class="header-anchor" href="#_2-7-3-当配置了-expire-不为-null-时-work-进程内部每次查询可用任务之前-会先自动重发已过期的任务。" aria-hidden="true">#</a> 2.7.3 当配置了 expire 不为 <code>null</code> 时，work 进程内部每次查询可用任务之前，会先自动重发已过期的任务。</h4><blockquote><p>补充：</p></blockquote><blockquote><p>在database 模式下，2.7.1 和 2.7.2 中的重发逻辑是先删除原来的任务，然后插入一个新的任务。2.7.3 中的重发时机是直接更新原任务。</p></blockquote><blockquote><p>而在redis 模式下，3种重发都是先删除再插入。</p></blockquote><blockquote><p>不管是哪种重发方式，重发之后，任务的已尝试次数会在原来的基础上 +1 。</p></blockquote><p>此外，消费者类中需要注意，如果 <code>fire()</code> 方法中可能抛出异常，那么</p><ul><li>如果不需要自动重发的话， 请在抛出异常之前将任务删除 <code>$job-&gt;delete()</code> ，以免产生bug。</li><li>如果需要自动重发的话，请直接抛出异常，不要在 <code>fire()</code> 方法中又手动使用 <code>$job-&gt;release()</code> , 这样会导致该任务被重发两次，产生两个一样的新任务。</li></ul><h3 id="_2-8-任务的失败回调及告警" tabindex="-1"><a class="header-anchor" href="#_2-8-任务的失败回调及告警" aria-hidden="true">#</a> 2.8 任务的失败回调及告警</h3><p>当同时满足以下条件时，将触发任务失败回调：</p><ul><li>命令行的 <code>--tries</code> 参数的值大于0</li><li>任务的已尝试次数大于 命令行的 <code>--tries</code> 参数</li><li>开发者添加了 <code>queue_failed</code> 事件标签及其对应的回调代码</li><li>消费者类中定义了 <code>failed()</code> 方法，用于接收任务失败的通知</li></ul><p>注意， <code>queue_failed</code> 标签需要在安装了 <code>thinkphp-queue</code> 之后 <strong>手动</strong> 去 <code>\application\tag.php</code> 文件中添加。</p><p><strong>注意：该版本有<a href="https://github.com/top-think/think-queue/issues/10" target="_blank" rel="noopener noreferrer">bug<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，若想实现失败任务回调功能，需要先修改位于 <code>think-queue\src\queue\Worker.php</code> 中的 <code>logFailedJob</code>方法 , 修改方式如下:</strong></p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token doc-comment comment">/**
 * Log a failed job into storage.
 * <span class="token keyword">@param</span>  <span class="token class-name"><span class="token punctuation">\</span>Think<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>Job</span> <span class="token parameter">$job</span>
 * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">array</span></span>
 */</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">logFailedJob</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Job</span> <span class="token variable">$job</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 将原来的 queue.failed&#39; 修改为 &#39;queue_failed&#39; 才可以触发任务失败回调</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name static-context">Hook</span><span class="token operator">::</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;queue.failed&#39;</span><span class="token punctuation">,</span> <span class="token variable">$job</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$job</span><span class="token operator">-&gt;</span><span class="token function">failed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;job&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$job</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;failed&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先，我们添加 <code>queue_failed</code> 事件标签, 及其对应的回调方法</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// 文件路径： \application\tags.php</span>
<span class="token comment">// 应用行为扩展定义文件</span>
<span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token comment">// 应用初始化</span>
    <span class="token string single-quoted-string">&#39;app_init&#39;</span>     <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 应用开始</span>
    <span class="token string single-quoted-string">&#39;app_begin&#39;</span>    <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 模块初始化</span>
    <span class="token string single-quoted-string">&#39;module_init&#39;</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 操作开始执行</span>
    <span class="token string single-quoted-string">&#39;action_begin&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 视图内容过滤</span>
    <span class="token string single-quoted-string">&#39;view_filter&#39;</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 日志写入</span>
    <span class="token string single-quoted-string">&#39;log_write&#39;</span>    <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 应用结束</span>
    <span class="token string single-quoted-string">&#39;app_end&#39;</span>      <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// 任务失败统一回调,有四种定义方式</span>
    <span class="token string single-quoted-string">&#39;queue_failed&#39;</span><span class="token operator">=&gt;</span> <span class="token punctuation">[</span>

         <span class="token comment">// 数组形式，[ &#39;ClassName&#39; , &#39;methodName&#39;]</span>
        <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;application\\behavior\\MyQueueFailedLogger&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;logAllFailedQueues&#39;</span><span class="token punctuation">]</span>

         <span class="token comment">// 字符串(静态方法)，&#39;StaicClassName::methodName&#39;</span>
         <span class="token comment">// &#39;MyQueueFailedLogger::logAllFailedQueues&#39;</span>

         <span class="token comment">// 字符串(对象方法)，&#39;ClassName&#39;，此时需在对应的ClassName类中添加一个名为 queueFailed 的方法</span>
         <span class="token comment">// &#39;application\\behavior\\MyQueueFailedLogger&#39;</span>

         <span class="token comment">// 闭包形式</span>
         <span class="token comment">/*
         function( &amp;$jobObject , $extra){
             // var_dump($jobObject);
             return true;
         }
         */</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里，我们选择数组形式的回调方式，新增 <code>\application\behavior\MyQueueFailedLogger</code> 类，添加一个 <code>logAllFailedQueues()</code> 方法</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token doc-comment comment">/**
 * 文件路径: \application\behavior\MyQueueFailedLogger.php
 * 这是一个行为类，用于处理所有的消息队列中的任务失败回调
 */</span>

<span class="token keyword">namespace</span> <span class="token package">application<span class="token punctuation">\</span>behavior</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">MyQueueFailedLogger</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> <span class="token constant">should_run_hook_callback</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">$jobObject</span>   \think\queue\Job   //任务对象，保存了该任务的执行情况和业务数据
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">bool</span></span>     true                  //是否需要删除任务并触发其failed() 方法
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">logAllFailedQueues</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$jobObject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token variable">$failedJobLog</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">&#39;jobHandlerClassName&#39;</span>   <span class="token operator">=&gt;</span> <span class="token variable">$jobObject</span><span class="token operator">-&gt;</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// &#39;application\index\job\Hello&#39;</span>
            <span class="token string single-quoted-string">&#39;queueName&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$jobObject</span><span class="token operator">-&gt;</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>               <span class="token comment">// &#39;helloJobQueue&#39;</span>
            <span class="token string single-quoted-string">&#39;jobData&#39;</span>   <span class="token operator">=&gt;</span> <span class="token variable">$jobObject</span><span class="token operator">-&gt;</span><span class="token function">getRawBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;data&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// &#39;{&#39;a&#39;: 1 }&#39;</span>
            <span class="token string single-quoted-string">&#39;attempts&#39;</span>  <span class="token operator">=&gt;</span> <span class="token variable">$jobObject</span><span class="token operator">-&gt;</span><span class="token function">attempts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment">// 3</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">var_export</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$failedJobLog</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token comment">// $jobObject-&gt;release();     //重发任务</span>
          <span class="token comment">//$jobObject-&gt;delete();         //删除任务</span>
          <span class="token comment">//$jobObject-&gt;failed();      //通知消费者类任务执行失败</span>

        <span class="token keyword">return</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">should_run_hook_callback</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要注意该回调方法的返回值：</p><ul><li>返回 true 时，系统会自动删除该任务，并且自动调用消费者类中的 <code>failed()</code> 方法</li><li>返回 false 时，系统不会自动删除该任务，也不会自动调用消费者类中的 <code>failed()</code> 方法，需要开发者另行处理失败任务的删除和通知。</li></ul><p>最后，在消费者类中，添加 <code>failed()</code> 方法</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token doc-comment comment">/**
 * 文件路径： \application\index\job\HelloJob.php
 */</span>

<span class="token doc-comment comment">/**
 * 该方法用于接收任务执行失败的通知，你可以发送邮件给相应的负责人员
 * <span class="token keyword">@param</span> <span class="token parameter">$jobData</span>  string|array|...      //发布任务时传递的 jobData 数据
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">failed</span><span class="token punctuation">(</span><span class="token variable">$jobData</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">send_mail_to_somebody</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Warning: Job failed after max retries. job data is :&quot;</span><span class="token operator">.</span><span class="token function">var_export</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样，就可以做到任务失败的<strong>记录</strong>与<strong>告警</strong></p><h3 id="_2-9-处理过期的任务" tabindex="-1"><a class="header-anchor" href="#_2-9-处理过期的任务" aria-hidden="true">#</a> 2.9 处理过期的任务</h3><p>过期这个概念用文字比较难描述清楚，建议先看一下 <strong>深入理解</strong> 中 <strong>3.4 消息处理的详细流程图</strong></p><h2 id="三-深入理解" tabindex="-1"><a class="header-anchor" href="#三-深入理解" aria-hidden="true">#</a> 三 深入理解</h2><h3 id="_3-1-thinkphp-queue-中消息与队列的保存方式" tabindex="-1"><a class="header-anchor" href="#_3-1-thinkphp-queue-中消息与队列的保存方式" aria-hidden="true">#</a> 3.1 thinkphp-queue 中消息与队列的保存方式</h3><ul><li><p>Redis</p><p>在 Redis 中，每一个 队列 都三个key 与之对应 ，以 helloJobQueue 队列举例，其在redis 中的保存方式为：</p><table><thead><tr><th>key名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>queues:helloJobQueue</td><td>List ， 列表</td><td>待执行的任务列表</td></tr><tr><td>queues:helloJobQueue:delayed</td><td>Sorted Set，有序集合</td><td>延迟执行和定时执行的任务集合</td></tr><tr><td>queues:helloJobQueue:reserved</td><td>Sorted Set，有序集合</td><td>执行中的任务集合</td></tr></tbody></table><blockquote><p>使用的<code>:</code>分隔符, 只是用来表示相关key的关联性。本身没有特殊含义。使用分隔符是一种常见的组织key的方式。</p></blockquote><p>其中，在<code>queues:helloJobQueue</code> 列表中，每个元素的形式如下：</p><p>在 <code>queues:helloJobQueue:delayed</code> 和 <code>queues:helloJobQueue:delayed</code> 有序集合中，每个元素的形式如下：</p><p>可以看到，在有序集合中，每个元素代表一个任务，该元素的 Score 为该任务的入队时间戳，任务的 value 为json 格式，保存了任务的执行情况和业务数据。将value decode 为数组后形式如下：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token punctuation">[</span>
  <span class="token string single-quoted-string">&#39;job&#39;</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;application\\index\\job\\Hello&#39;</span> <span class="token punctuation">,</span>  <span class="token comment">// jobHandlerClassName，消费者类的类名</span>
  <span class="token string single-quoted-string">&#39;data&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>                      <span class="token comment">// 生产者传入的业务数据</span>
     <span class="token string single-quoted-string">&#39;time&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;2017-02-18 16:20:10&#39;</span><span class="token punctuation">,</span>
     <span class="token string single-quoted-string">&#39;data&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;I have 648 apples&#39;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string single-quoted-string">&#39;id&#39;</span>   <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;77IasdasadIasdadadadKL8t&#39;</span><span class="token punctuation">,</span>    <span class="token comment">// 一个随机的32位字符串</span>
  <span class="token string single-quoted-string">&#39;attempts&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">2</span>                <span class="token comment">// 任务的已尝试次数</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>redis驱动下，为了实现任务的延迟执行和过期重发，任务将在这三个key中来回转移，详情可见 3.5</p></li><li><p>Database</p><p>在 Database 中，每个任务对应到表中的一行，queue 字段用来区分不同的队列。</p><p>表的字段结构如下:</p><p>其中，payLoad 字段保存了消息的执行者和业务数据，payLoad 字段采用 json 格式的字符串来保存消息，将其 decode 为数组后形式如下：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token punctuation">[</span>
 <span class="token string single-quoted-string">&#39;job&#39;</span>   <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;application\\index\\job\\Hello&#39;</span><span class="token punctuation">,</span> <span class="token comment">// jobHandlerClassName，消费者类的类名</span>
 <span class="token string single-quoted-string">&#39;data&#39;</span>  <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">array</span><span class="token operator">|</span><span class="token class-name">integer</span><span class="token operator">|</span><span class="token keyword type-declaration">object</span>       <span class="token comment">// 生产者传入的业务数据</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_3-2-thinkphp-queue-的目录结构和类关系图" tabindex="-1"><a class="header-anchor" href="#_3-2-thinkphp-queue-的目录结构和类关系图" aria-hidden="true">#</a> 3.2 thinkphp-queue 的目录结构和类关系图</h3><p>这些类构成了消息队列中的几个角色：</p><table><thead><tr><th>角色</th><th>类名</th><th>说明</th></tr></thead><tbody><tr><td>命令行</td><td>Command + Worker</td><td>负责解析命令行参数，控制队列的启动，重启</td></tr><tr><td>驱动</td><td>Queue + Connector</td><td>负责队列的创建，以及消息的入队，出队等操作</td></tr><tr><td>任务</td><td>Job</td><td>用于将消息转化为一个任务对象，供消费者使用</td></tr><tr><td>生产者</td><td>业务代码</td><td>负责消息的创建与发布</td></tr><tr><td>消费者</td><td>业务代码</td><td>负责任务的接收与执行</td></tr></tbody></table><p>各个类之间的关系图如下：</p><p><img src="https://blog.huzhongyuan.com/wp-content/uploads/2017/02/thinkphp-queue类关系图.svg" alt="thinkphp-queue类关系图"></p><h3 id="_3-3-deamon模式的执行流程" tabindex="-1"><a class="header-anchor" href="#_3-3-deamon模式的执行流程" aria-hidden="true">#</a> 3.3 Deamon模式的执行流程</h3><p><img src="https://blog.huzhongyuan.com/wp-content/uploads/2017/02/Daemon模式与非daemon模式状态图.svg" alt="Daemon模式与非daemon模式状态图"></p><h3 id="_3-4-database模式下消息处理的详细流程" tabindex="-1"><a class="header-anchor" href="#_3-4-database模式下消息处理的详细流程" aria-hidden="true">#</a> 3.4 Database模式下消息处理的详细流程</h3><p>下图中，展示了database 模式下消息处理的详细流程，redis 驱动下大体类似</p><p><img src="https://blog.huzhongyuan.com/wp-content/uploads/2017/02/Database驱动下消息处理的具体流程.svg" alt="Database模式下消息获取和执行的具体流程"></p><h3 id="_3-5-redis-驱动下的任务重发细节" tabindex="-1"><a class="header-anchor" href="#_3-5-redis-驱动下的任务重发细节" aria-hidden="true">#</a> 3.5 redis 驱动下的任务重发细节</h3><p>在redis驱动下，为了实现任务的延迟执行和过期重发，任务将在这三个key中来回转移。</p><p>在3.4 Database模式下消息处理的消息流程中，我们知道，如果配置的expire 不是null ，那么 thinkphp-queue的work进程每次在获取下一个可执行任务之前，会先尝试重发所有过期的任务。而在redis驱动下，这个步骤则做了更多的事情，详情如下：</p><ol><li>从 <code>queue:xxx:delayed</code> 的key中查询出有哪些任务在当前时刻已经可以开始执行，然后将这些任务转移到 <code>queue:xxx</code> 的key的尾部。</li><li>从 <code>queue:xxx:reserved</code> 的key中查询出有哪些任务在当前时刻已经过期，然后将这些任务转移到 <code>queue:xxx</code>的key的尾部。</li><li>尝试从 <code>queue:xxx</code> 的key的头部取出一个任务，如果取出成功，那么，将这个任务转移到 <code>queue:xxx:reserved</code> 的key 的头部，同时将这个任务实例化成任务对象，交给消费者去执行。</li></ol><p>用图来表示这个步骤的具体过程如下：</p><p>redis队列中的过期任务重发步骤--执行前：</p><p><img src="https://blog.huzhongyuan.com/wp-content/uploads/2017/02/redis队列中的任务管理-1.png" alt="redis队列中的过期任务重发步骤-执行前"></p><p>redis队列中的过期任务重发步骤--执行后：</p><p><img src="https://blog.huzhongyuan.com/wp-content/uploads/2017/02/redis队列中的任务管理-2.png" alt="redis队列中的过期任务重发步骤--执行后"></p><h3 id="_3-6-thinkphp-queue的性能" tabindex="-1"><a class="header-anchor" href="#_3-6-thinkphp-queue的性能" aria-hidden="true">#</a> 3.6 thinkphp-queue的性能</h3><ul><li><p>测试环境 :</p><p>虚拟机 Ubuntu 16.04 ， PHP 7.1 ，TP5，Redis 3.2 ， 双核 I5 6400，3G 内存</p></li><li><p>测试方式 :</p><p>使用 Redis 驱动，在一个控制器中循环推送 40000 条消息到消息队列；</p><p>使用<code>php think queue:work --daemon</code>去消费这些消息，计算推送和消费各自所耗的时间。</p></li><li><p>测试结果 :</p><p>在最简单的逻辑下，平均每秒中可推送8000个消息，平均每秒可消费200个消息。</p></li></ul><p><strong>注意：<strong>由于在测试时，Host 机本身的cpu和内存长期100%，并且虚拟机中的各项服务并未专门调优，因此该测试结果</strong>并不具备参考性</strong>。</p><h3 id="_3-7-thinkphp-queue-的n种错误使用姿势" tabindex="-1"><a class="header-anchor" href="#_3-7-thinkphp-queue-的n种错误使用姿势" aria-hidden="true">#</a> 3.7 thinkphp-queue 的N种错误使用姿势</h3><h4 id="_3-7-1-在-消费者类的-fire-方法中-忘记使用-job-delete-去删除消息-这种情况下-会产生一系列的bug" tabindex="-1"><a class="header-anchor" href="#_3-7-1-在-消费者类的-fire-方法中-忘记使用-job-delete-去删除消息-这种情况下-会产生一系列的bug" aria-hidden="true">#</a> 3.7.1 在 消费者类的 <code>fire()</code> 方法中，忘记使用 <code>$job-&gt;delete()</code> 去删除消息，这种情况下，会产生一系列的bug：</h4><ul><li><p>配置的 expire 为 <code>null</code> ， 则该任务被执行一次后会永远留在消息队列中，占用消息队列的空间 , 除非开发者另行处理。</p></li><li><p>配置的 expire <code>不为 null</code> ，该任务在 expire 秒后被认为是过期任务，并被消息队列还原为待执行状态，在消息队列的后面的循环中继续被获取，这时，如果</p></li><li><p>命令行中的 <code>--tries</code> 参数为0 或者未设置,那么每隔 一段时间该任务就会被执行一次。</p></li><li><p>命令行中的 <code>--tries</code> 参数 n 大于0 ， 那么当这个任务被误执行的次数超过n 时，会由消息队列尝试去触发失败回调事件:</p></li><li><p>如果开发者没有编写失败处理的回调事件：那么该任务仍然不会被删除，每隔一段时间就会被执行一次。[这个可能属于框架的<a href="https://github.com/top-think/think-queue/issues/10" target="_blank" rel="noopener noreferrer">Bug<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>] ,</p></li><li><p>如果编写了失败回调事件</p><ul><li>回调事件中删除了任务，则这个任务被误执行了 n 次。</li><li>回调事件中未删除任务，这时，如果： <ul><li>回调事件返回值是 false，那么该任务仍然不会被删除，每隔一段时间就会被执行一次</li><li>回调事件返回值是 true， 那么该任务会先被删除，然后触发消费者类的 failed() 方法，如果在 failed() 方法中设置了告警，那么这个告警就是一次误报。</li></ul></li></ul></li></ul><p>因此，在 使用 thinkphp-queue 时，请记得：</p><ul><li><strong>任务完成后, 使用 <code>$job-&gt;delete()</code> 删除任务</strong></li><li>在消费者类的 <code>fire()</code> 方法中，使用 <code>$job-&gt;attempt()</code> 检查任务已执行次数，对于次数异常的，作相应的处理。</li><li>在消费者类的 <code>fire()</code> 方法中，根据业务数据来判断该任务是否已经执行过，以避免该任务被重复执行。</li><li>编写失败回调事件，将事件中失败的任务及时通知给开发人员。</li></ul><h4 id="_3-7-2-使用了-queue-work-daemon-但更新代码后没有使用-queue-restart-重启-work-进程-使得-work-进程中的代码与最新的代码不同-出现各种问题。" tabindex="-1"><a class="header-anchor" href="#_3-7-2-使用了-queue-work-daemon-但更新代码后没有使用-queue-restart-重启-work-进程-使得-work-进程中的代码与最新的代码不同-出现各种问题。" aria-hidden="true">#</a> 3.7.2 使用了 <code>queue:work --daemon</code> ，但更新代码后没有使用 <code>queue:restart</code> 重启 work 进程, 使得 work 进程中的代码与最新的代码不同，出现各种问题。</h4><h4 id="_3-7-3-使用了-queue-work-daemon-但是消费者类的-fire-方法中存在死循环-或-sleep-n-等逻辑-导致消息队列被堵塞-或者使用了-exit-die-这样的逻辑-导致work进程直接终止-。" tabindex="-1"><a class="header-anchor" href="#_3-7-3-使用了-queue-work-daemon-但是消费者类的-fire-方法中存在死循环-或-sleep-n-等逻辑-导致消息队列被堵塞-或者使用了-exit-die-这样的逻辑-导致work进程直接终止-。" aria-hidden="true">#</a> 3.7.3 使用了 <code>queue:work --daemon</code> ，但是消费者类的 fire() 方法中存在死循环，或 <code>sleep(n)</code> 等逻辑，导致消息队列被堵塞；或者使用了 <code>exit()</code> , <code>die()</code> 这样的逻辑，导致work进程直接终止 。</h4><h4 id="_3-7-4-配置的-expire-为-null-这时如果采用的是-redis-驱动且使用了延迟功能-如-later-n-release-n-方法或者-delay-参数不为0-那么将导致被延迟的任务永远无法处理。-这个可能属于框架的bug" tabindex="-1"><a class="header-anchor" href="#_3-7-4-配置的-expire-为-null-这时如果采用的是-redis-驱动且使用了延迟功能-如-later-n-release-n-方法或者-delay-参数不为0-那么将导致被延迟的任务永远无法处理。-这个可能属于框架的bug" aria-hidden="true">#</a> 3.7.4 配置的 expire 为 <code>null</code> ，这时如果采用的是 Redis 驱动且使用了延迟功能，如 <code>later(n)</code> ， <code>release(n)</code> 方法或者 <code>--delay</code> 参数不为0 ， 那么将导致被延迟的任务永远无法处理。(这个可能属于框架的<a href="https://github.com/top-think/think-queue/issues/12" target="_blank" rel="noopener noreferrer">Bug<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</h4><h4 id="_3-7-5-配置的-expire-为null-但并没有自行处理过期的任务-导致过期的任务得不到处理-且一直占用消息队列的空间。" tabindex="-1"><a class="header-anchor" href="#_3-7-5-配置的-expire-为null-但并没有自行处理过期的任务-导致过期的任务得不到处理-且一直占用消息队列的空间。" aria-hidden="true">#</a> 3.7.5 配置的 expire 为<code>null</code> ，但并没有自行处理过期的任务，导致过期的任务得不到处理，且一直占用消息队列的空间。</h4><h4 id="_3-7-6-配置的-expire-不为null-但配置的-expire-时间太短-以至于-expire-时间-消费者的-fire-方法所需时间-删除该任务所需的时间-那么任务将被误认为执行超时-从而被消息队列还原为待执行状态。" tabindex="-1"><a class="header-anchor" href="#_3-7-6-配置的-expire-不为null-但配置的-expire-时间太短-以至于-expire-时间-消费者的-fire-方法所需时间-删除该任务所需的时间-那么任务将被误认为执行超时-从而被消息队列还原为待执行状态。" aria-hidden="true">#</a> 3.7.6 配置的 expire <code>不为null</code> ，但配置的 expire 时间太短，以至于 expire 时间 &lt; 消费者的 <code>fire()</code> 方法所需时间 + 删除该任务所需的时间 ，那么任务将被误认为执行超时，从而被消息队列还原为待执行状态。</h4><h4 id="_3-7-7-使用-queue-push-jobhandlerclassname-jobdata-jobqueuename-推送任务时-jobdata-中包含未序列化的对象。这时-在消费者端拿到的-jobdata-中拿到的是该对象的public-属性的键值对数组。因此-需要在推送前手动序列化对象-在消费者端再手动反序列化还原为对象。" tabindex="-1"><a class="header-anchor" href="#_3-7-7-使用-queue-push-jobhandlerclassname-jobdata-jobqueuename-推送任务时-jobdata-中包含未序列化的对象。这时-在消费者端拿到的-jobdata-中拿到的是该对象的public-属性的键值对数组。因此-需要在推送前手动序列化对象-在消费者端再手动反序列化还原为对象。" aria-hidden="true">#</a> 3.7.7 使用 <code>Queue::push($jobHandlerClassName , $jobData, $jobQueueName );</code> 推送任务时，<code>$jobData</code> 中包含未序列化的对象。这时，在消费者端拿到的 <code>$jobData</code> 中拿到的是该对象的public 属性的键值对数组。因此，需要在推送前手动序列化对象，在消费者端再手动反序列化还原为对象。</h4><h2 id="四-拓展" tabindex="-1"><a class="header-anchor" href="#四-拓展" aria-hidden="true">#</a> 四 拓展</h2><h3 id="_4-1-队列的稳定性和拓展性" tabindex="-1"><a class="header-anchor" href="#_4-1-队列的稳定性和拓展性" aria-hidden="true">#</a> 4.1 队列的稳定性和拓展性</h3><ul><li>稳定性：不管是 listen 模式还是 work 模式，都建议使用 supervisor 或者 自定义的cron 脚本，去定时检查 work 进程是否正常</li><li>拓展性： 当某个队列的消费者不足时，再给这个队列添加 work进程即可。</li></ul><h3 id="_4-2-消息队列的可视化管理工具" tabindex="-1"><a class="header-anchor" href="#_4-2-消息队列的可视化管理工具" aria-hidden="true">#</a> 4.2 消息队列的可视化管理工具</h3><ul><li>队列管理，队列的列表，队列的 work 进程数量控制，队列的任务数量变化趋势 //TBD</li><li>任务管理，任务的列表，添加/<strong>撤回</strong>/查询任务，修改任务的 执行者/执行时间/优先级/数据 等 //TBD</li></ul><h3 id="_4-2-编写自定义的-thinkphp-queue-驱动" tabindex="-1"><a class="header-anchor" href="#_4-2-编写自定义的-thinkphp-queue-驱动" aria-hidden="true">#</a> 4.2 编写自定义的 thinkphp-queue 驱动</h3><p>//TBD</p><h3 id="_4-3-编写消息队列的单元测试" tabindex="-1"><a class="header-anchor" href="#_4-3-编写消息队列的单元测试" aria-hidden="true">#</a> 4.3 编写消息队列的单元测试</h3><p>//TBD</p><h3 id="_4-4-与其他php消息队列库的对比" tabindex="-1"><a class="header-anchor" href="#_4-4-与其他php消息队列库的对比" aria-hidden="true">#</a> 4.4 与其他PHP消息队列库的对比</h3><p>TP5的消息队列与Laravel的消息队列比较相似，下面是与laravel 中的消息队列的一些对比：</p><table><thead><tr><th></th><th>thinkphp-queue (v1.1.2)</th><th>laravel-queue (v5.3)</th></tr></thead><tbody><tr><td>内置的驱动</td><td>Database，Redis，Sync，TopThink</td><td>Database，Redis, Sync(在laravel中称为 null)。</td></tr><tr><td>Redis驱动要求</td><td>装redis的C扩展</td><td>安装 predis 包 + LUA脚本 推送任务</td></tr><tr><td>推送任务</td><td>允许推送 消费者类名，消费者对象</td><td>允许推送消费者类名，消费者对象，闭包</td></tr><tr><td>失败任务处理</td><td>触发失败回调事件 (有Bug)</td><td>触发失败回调事件 + 移动任务到 failed_jobs表?</td></tr><tr><td>消息订阅</td><td>subscribe 命令+ Topthink驱动(注：未实现/未提供)</td><td>subscribe 命令 + 安装IronMQ 驱动</td></tr><tr><td>删除任务</td><td>消费者类中手动删除</td><td>任务完成后自动删除</td></tr><tr><td>推送到多个队列</td><td>需自己实现</td><td>原生支持</td></tr><tr><td>延迟执行</td><td>支持 (有Bug)</td><td>支持</td></tr><tr><td>消息重发</td><td>支持</td><td>支持</td></tr><tr><td>检查已执行次数</td><td>原生支持</td><td>需在消费者类中显式 use 相关的 trait</td></tr><tr><td>执行方式</td><td>work 模式 + listen 模式</td><td>work 模式 + listen 模式</td></tr><tr><td>进程命令</td><td>开启，停止，重启</td><td>开启，停止，重启</td></tr><tr><td>任务命令</td><td>无</td><td>展示失败任务列表，重试某个失败任务，删除某个失败任务</td></tr><tr><td>支持的事件</td><td>失败回调事件</td><td>失败回调事件，支持消费前事件，消费后事件</td></tr></tbody></table><p>使用supervisor管理think-queue示例</p><p>配置文件 /etc/supervisord.conf 末尾添加以下代码：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>program:php<span class="token punctuation">]</span>
<span class="token assign-left variable">command</span><span class="token operator">=</span> /usr/bin/php think queue:work --queue notify --daemon <span class="token punctuation">;</span> 被监控进程
<span class="token assign-left variable">directory</span><span class="token operator">=</span>/home/wwwroot/dlsj.mrpzx.com
<span class="token punctuation">;</span><span class="token assign-left variable">process_name</span><span class="token operator">=</span>%<span class="token punctuation">(</span>process_num<span class="token punctuation">)</span>02d
<span class="token punctuation">;</span><span class="token assign-left variable">numprocs</span><span class="token operator">=</span><span class="token number">5</span> <span class="token comment">#启动几个进程</span>
<span class="token assign-left variable">autostart</span><span class="token operator">=</span>true <span class="token punctuation">;</span>随着supervisord的启动而启动
<span class="token assign-left variable">autorestart</span><span class="token operator">=</span>true <span class="token punctuation">;</span>自动启动
<span class="token assign-left variable">startsecs</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">;</span>程序重启时候停留在runing状态的秒数
<span class="token assign-left variable">startretries</span><span class="token operator">=</span><span class="token number">10</span> <span class="token punctuation">;</span>启动失败时的最多重试次数
<span class="token assign-left variable">redirect_stderr</span><span class="token operator">=</span>true <span class="token punctuation">;</span>重定向stderr到stdout
<span class="token assign-left variable">stdout_logfile</span><span class="token operator">=</span>/root/supervisor.log <span class="token punctuation">;</span>stdout文件
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>复制代码 值得注意的是 每行的 ; 要跟前面的命令用空格隔开， 不能挨着， 然后注释文字要以;开头， 不能#开头 ，每行 ; 作为命令的结尾</p><!--]--></div><!--]--><!----><!--]--></div><div class="article-belong" data-v-6491d27a><div class="article-info" cover="/post/server/images/supervisorctl_sh.png" data-v-6491d27a><!--[--><!--[--><span class="category-info" aria-label="分类🌈" data-balloon-pos="down" data-v-5aa23620><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" arialabelledby="category" data-v-5aa23620><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper" data-v-5aa23620><!--[--><li class="category category0 clickable" data-v-5aa23620><span role="navigation" data-v-5aa23620>服务器操作</span></li><!--]--><meta property="articleSection" content="服务器操作" data-v-5aa23620></ul></span><!--]--><!--[--><span aria-label="标签🏷" data-balloon-pos="down" data-v-49d8fb42><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag" data-v-49d8fb42><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper" data-v-49d8fb42><!--[--><li class="tag tag0 clickable" data-v-49d8fb42><span role="navigation" data-v-49d8fb42>centos</span></li><li class="tag tag1 clickable" data-v-49d8fb42><span role="navigation" data-v-49d8fb42>supervisor</span></li><li class="tag tag2 clickable" data-v-49d8fb42><span role="navigation" data-v-49d8fb42>think-queue</span></li><!--]--></ul></span><!--]--><!--[--><div></div><!--]--><!--]--></div></div></div><div class="article-footer" data-v-6491d27a><footer class="page-meta" data-v-6491d27a><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-weasel/vuepress-theme-weasel/edit/main/blog/server/centos7结合supervisor和think-queue实现队列.md" rel="noopener noreferrer" target="_blank" arialabel="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" arialabelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/7/8 08:46:54</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: sujinw@qq.com">cavinhuang</span><!--]--><!--]--></div></footer></div></article><div class="article-nav-container" data-v-6491d27a><nav class="page-nav" data-v-6491d27a><a href="/post/server/Centos7%E7%A1%AC%E7%9B%98%E6%8C%82%E8%BD%BD%E6%96%B9%E6%B3%95.html" class="nav-link prev" arialabel="Centos7硬盘挂载方法"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->Centos7硬盘挂载方法</div></a><a href="/post/server/linux-centos-7-%E4%B8%8B%E5%AE%89%E8%A3%85nginx1-13-php7-0%E7%8E%AF%E5%A2%83.html" class="nav-link next" arialabel="linux centos 7 下安装nginx1.13+php7.0环境"><div class="link">linux centos 7 下安装nginx1.13+php7.0环境<!----></div><div class="hint">下一页<span class="arrow right"></span></div></a></nav></div><div class="article-comment" data-v-6491d27a><div class="giscus-wrapper input-top" style="display:block;" data-v-6491d27a></div></div><div class="article-author-info" data-v-6491d27a><div class="author-info-card" data-v-6491d27a><div class="author-info-avatar"><img src="https://avatars.githubusercontent.com/u/24950299?v=4" alt="CavinHuang"></div><div class="author-info-content"><div class="author-header"><span class="author-name">CavinHuang</span><span class="author-more-article">查看所有文章</span></div><div class="author-slogen">呼喊是爆发的沉默，沉默是无声的召唤。不论激越还是宁静，我祈求只要不是平淡。没有比脚更长的路，没有比人更高的山。</div></div></div></div><div class="article-recommend" data-v-6491d27a><div class="recomment-list" data-v-6491d27a><div class="recommand-list-title">热门文章推荐</div><div class="recommend-list-articles"><!--[--><div class="recommend-article"><div class="article-summay"><div class="article-summay-content">#&lt;br /&gt; 页面信息&lt;br /&gt;
&lt;br /&gt;你可以在 Markdown 的 Frontmatter 中设置页面信息。&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;作者设置为 Ms.Huang.&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;写作时间应为 2020 年 1 月 1 日&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;分类为 “使用指南”&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;标签为 “页面配置” 和 “使用指南”&lt;br /&gt;
&lt;br /&gt;
</div></div><div class="article-title">页面配置</div></div><!--]--></div></div></div><!--]--><!----></div><!--]--><!----><!--]--></main><!--[--><!--[--><aside class="blog-info-wrapper"><!--[--><!--[--><div class="blogger-info" vocab="https://schema.org" typeof="Person"><div class="blogger" style="cursor:pointer;" aria-label="个人介绍" data-balloon-pos="down" role="navigation"><img class="blogger-avatar" src="/./avatar.jpg" alt="Blogger Avatar"><div class="blogger-name" property="name">Mr.Huang</div><div class="blogger-description">一个前端开发者</div><meta property="url" content="/about-me.html"></div><div class="num-wrapper"><div><div class="num">41</div><div>文章</div></div><div><div class="num">21</div><div>分类</div></div><div><div class="num">52</div><div>标签</div></div><div><div class="num">59</div><div>时间轴</div></div></div><div class="social-media-wrapper"><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Baidu" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon baidu-icon" viewBox="0 0 1024 1024" ariaLabelledby="baidu"><circle cx="512" cy="512" r="512" fill="#1D2FE3" />,<path d="M239.022 704.978c.098-4.865-.314-9.772.162-14.591 5.178-52.464 197.571-253.377 249.641-259.233 42.996-4.833 75.768 16.545 99.824 49.144 37.893 51.351 82.81 95.455 131.292 136.237 52.903 44.503 56.525 99.801 32.6 158.592-23.425 57.56-75.34 69.833-127.771 58.804-84.971-17.874-168.158-13.744-253.37-4.536-86.35 9.333-133.788-39.4-132.378-124.417zM352.464 412.86c-3.58 50.707-17.93 96.128-75.9 98.12-58.053 1.995-80.093-41.432-79.275-91.71.81-49.705 13.416-104.053 76.851-102.136 53.84 1.625 74.74 45.8 78.324 95.726zm386.053 142.168c-68.494-1.735-84.188-43.331-82.635-93.812 1.46-47.519 10.082-97.628 73.299-96.65 61.395.95 81.6 43.207 81.553 98.668-.047 53.156-19.818 89.398-72.217 91.794zm-45.235-278.345c-10.464 42.665-24.513 91.761-85.919 94.502-52.74 2.354-71.705-34.482-72.805-81.242-1.233-52.42 48.08-112.965 87.582-110.373 33.943 2.226 71.146 49.541 71.142 97.113zm-195.147-14.097c-7.005 46.274-13.63 100.025-71.562 101.351-57.077 1.306-73.567-47.922-73.638-97.109-.068-48.054 12.128-99.024 69.345-101.426 59.45-2.493 67.11 51.093 75.855 97.184z" fill="#fff" />,<path d="M479.52 663.165c.006 12.194 1.498 24.61-.284 36.537-4.707 31.503 18.862 78.749-45.326 77.534-54.226-1.027-103.338-3.31-113.231-73.536-7.164-50.852 7.78-85.674 57.687-102.668 17.67-6.016 39.618 5.058 54.096-14.548 10.84-14.679-2.901-54.592 33.418-41.47 24.075 8.7 11.477 38.922 13.278 59.652 1.68 19.366.359 38.99.363 58.5zm175.45 41.902c4.291 39.657 5.093 78.047-64.709 73.503-60.097-3.912-95.56-20.794-86.293-85.624 4.287-29.991-21.148-83.238 22.19-84.867 42.71-1.606 13.57 50.41 20.825 77.622 5.276 19.794-3.984 46.774 29.753 48.193 41.337 1.738 28.383-30.022 31.099-51.604 1.209-9.61-.85-19.65.528-29.215 2.516-17.474-8.928-44.716 19.554-47.191 36.044-3.133 24.155 28.376 26.678 47.523 1.896 14.387.375 29.225.375 51.66z" fill="#1D2FE3" />,<path d="M435.669 685.038c-2.255 24.07 5.605 53.68-33.623 52.136-34.594-1.362-35.274-31.818-38.513-53.078-4.028-26.448 11.38-48.18 40.785-50.023 40.967-2.564 27.097 30.764 31.35 50.965z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Bitbucket" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon bitbucket-icon" viewBox="0 0 1024 1024" ariaLabelledby="bitbucket"><circle cx="512" cy="512" r="512" fill="#205081" />,<path d="M512 191.32v.01-.01c-152.76 0-277.805 41.114-277.805 92.166 0 13.443 33.353 206.247 46.577 282.708 5.932 34.285 94.508 84.563 231.126 84.563l.102-.407v.407c137.484 0 225.26-50.278 231.192-84.578 13.23-76.457 46.592-269.255 46.592-282.698.005-51.047-125.024-92.165-277.784-92.165zm0 397.493c-48.771 0-88.31-39.545-88.31-88.31 0-48.772 39.539-88.306 88.31-88.306s88.31 39.534 88.31 88.31c0 48.766-39.539 88.306-88.31 88.306zm-.05-276.842c-98.256-.153-177.885-17.232-177.855-38.14.036-20.912 79.72-37.731 177.976-37.568 98.256.153 177.884 17.22 177.849 38.139-.026 20.908-79.705 37.716-177.966 37.564z" fill="#fff" />,<path d="M711.668 642.814c-4.227 0-7.608 2.994-7.608 2.994S635.65 699.987 512 699.987s-192.06-54.18-192.06-54.18-3.386-2.988-7.608-2.988c-5.04 0-9.827 3.391-9.827 10.871 0 .79.076 1.579.224 2.353 10.617 56.826 18.382 97.206 19.736 103.347 9.268 41.805 91.045 73.411 189.525 73.411h.01c98.49 0 180.267-31.606 189.535-73.411 1.364-6.136 9.114-46.49 19.736-103.317.143-.779.224-1.578.224-2.368 0-7.485-4.786-10.881-9.827-10.881zM467.659 500.477a44.255 44.255 0 1 0 88.51 0 44.255 44.255 0 1 0-88.51 0z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Dingding" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon dingding-icon" viewBox="0 0 1024 1024" ariaLabelledby="dingding"><circle cx="512" cy="512" r="512" fill="#1C9DF7" />,<path d="M760.551 442.095c0 5.178-5.178 12.945-7.767 20.713-23.302 49.192-82.85 144.988-82.85 144.988l-18.124 31.069h85.44L576.727 853.758l36.247-144.988h-67.316l23.302-95.796c-18.124 5.178-41.426 10.356-67.316 18.124 0 0-36.247 20.712-100.974-38.837 0 0-44.015-38.836-18.124-49.192 10.356-5.178 54.37-10.356 88.029-12.945 44.014-5.179 72.494-10.357 72.494-10.357s-139.81 2.59-173.468-2.589c-33.658-5.178-75.083-59.549-82.85-108.741 0 0-12.946-25.89 28.48-12.945 44.013 12.945 222.66 49.192 222.66 49.192s-235.606-72.494-251.14-90.618c-15.535-18.123-46.604-95.796-41.426-144.988 0 0 2.59-12.945 12.945-7.767 0 0 173.469 80.261 292.566 121.686 119.098 41.426 222.66 64.727 209.715 119.098z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Discord" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon discord-icon" viewBox="0 0 1024 1024" ariaLabelledby="discord"><circle cx="512" cy="512" r="512" fill="#2DAAE1" />,<path d="m422.935 240.147 5.851 8.052c-113.039 34.253-165.649 84.585-165.649 84.585s13.645-8.052 37.024-18.123c66.28-30.215 118.865-38.267 142.244-40.286 3.91 0 7.819-1.994 9.76-1.994 38.966-6.058 81.816-6.058 126.658-2.02 58.462 8.053 122.749 24.157 187.061 62.423 0 0-48.7-48.338-155.862-82.566l7.767-10.071h1.968c13.308.233 91.757 4.246 173.416 68.481 0 0 89.634 169.144 89.634 376.555 1.942-2.02-50.668 92.637-189.003 96.65 0 0-23.405-28.194-40.933-52.35 81.84-24.157 113.013-76.534 113.013-76.534a313.796 313.796 0 0 1-72.106 38.267c-31.172 14.11-60.403 22.162-89.633 28.22-60.404 12.066-114.955 8.027-161.74 0a636.81 636.81 0 0 1-91.576-28.22c-13.644-6.033-29.23-12.065-44.817-22.137-1.941-2.02-3.883-2.02-5.85-4.039-1.943 0-1.943-2.02-1.943-2.02-11.702-6.032-17.528-10.07-17.528-10.07s29.23 52.376 109.104 76.532c-19.47 24.157-40.907 54.371-40.907 54.371-138.36-4.039-190.97-98.67-190.97-98.67 0-207.41 89.633-376.555 89.633-376.555 89.634-70.5 175.384-68.481 175.384-68.481zm213.961 233.017c-35.315 0-64.727 34.512-64.727 77.672s29.412 77.672 64.727 77.672 64.727-34.512 64.727-77.672-29.412-77.672-64.727-77.672zm-233.016 0c-35.315 0-64.727 34.512-64.727 77.672s29.412 77.672 64.727 77.672 64.726-34.512 64.726-77.672-29.411-77.672-64.726-77.672z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Dribbble" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon dribbble-icon" viewBox="0 0 1024 1024" ariaLabelledby="dribbble"><circle cx="512" cy="512" r="512" fill="#DC4373" />,<path d="M716.668 302.752c-13.332 5.154-28.61 3.676-35.726-1.068-86.196-48.27-179.286-62.06-265.482-37.926C292.074 300.212 241.674 437.028 242 564.746c22.622 42.136 52.558 105.234 61.854 153.104l298.24 298.246c210.532-37.376 376.584-203.408 413.986-413.928L716.668 302.752z" fill="#C13366" />,<path d="M511.994 219.308c-161.592 0-293.058 131.31-293.058 292.696s131.466 292.684 293.058 292.684c161.598 0 293.07-131.292 293.07-292.684 0-161.386-131.472-292.696-293.07-292.696zm192.842 138.148c33.43 41.432 53.744 93.756 54.682 150.772-11.122-2.282-58.23-11.068-114.526-11.068-18.164 0-37.282.91-56.448 3.278a822.854 822.854 0 0 0-4.938-11.812c-4.972-11.692-10.326-23.29-15.874-34.72 86.642-35.696 128.436-85.238 137.104-96.45zm-192.842-92.33c62.446 0 119.528 23.2 163.126 61.412-6.902 9.416-44.332 56.202-127.876 87.768-38.67-70.688-80.996-129.22-91.07-142.812a247.13 247.13 0 0 1 55.82-6.368zm-106.352 23.99c8.536 11.758 50.928 70.918 90.592 141.036-106.448 27.982-200.976 29.806-223.79 29.806h-2.424c16.39-75.534 67.424-138.298 135.622-170.842zM264.402 512.39c0-2.038.034-4.076.1-6.102 1.48.018 3.666.018 6.5.018 30.726 0 137.382-2.538 247.288-35.154a828.402 828.402 0 0 1 18.928 39.526 232.24 232.24 0 0 0-8.234 2.482C405.236 553.126 337.216 658.936 326.75 676.232c-38.778-43.696-62.348-101.058-62.348-163.842zm247.592 247.246c-56.786 0-109.192-19.232-151.01-51.48 7.074-13.868 58.412-106.3 194.026-153.5a1.806 1.806 0 0 1 .272-.09c34.006 88.53 48.408 162.834 52.358 185.862-29.432 12.374-61.752 19.208-95.646 19.208zm140.236-43.584c-3.32-19.052-16.66-88.688-47.452-173.618 17.27-2.686 34.072-3.748 49.828-3.748 51.748 0 92.23 11.33 101.634 14.204-11.182 67.444-49.794 125.808-104.01 163.162z" fill="#F0F1F1" />,<path d="M511.994 219.308c-.382 0-.758.028-1.142.028v45.804c.38 0 .758-.018 1.142-.018 62.446 0 119.528 23.2 163.126 61.412-6.902 9.416-44.332 56.202-127.876 87.768-12.14-22.194-24.642-43.188-36.392-61.968V473.29c2.476-.706 4.954-1.41 7.434-2.144a828.402 828.402 0 0 1 18.928 39.526c-2.776.796-5.514 1.592-8.234 2.478a323.314 323.314 0 0 0-18.128 6.52v53.228a418.976 418.976 0 0 1 44.428-18.332c34.006 88.53 48.408 162.834 52.358 185.862-29.428 12.374-61.746 19.208-95.646 19.208-.382 0-.758-.024-1.142-.024v45.05c.382 0 .758.028 1.142.028 161.598 0 293.07-131.292 293.07-292.684.002-161.388-131.47-292.698-293.068-292.698zm71.614 269.316c-4.972-11.692-10.326-23.29-15.874-34.72 86.64-35.696 128.434-85.236 137.102-96.45 33.43 41.432 53.748 93.756 54.682 150.77-11.122-2.282-58.23-11.068-114.522-11.068-18.164 0-37.282.914-56.448 3.278-1.624-3.932-3.24-7.852-4.94-11.81zm68.622 227.428c-3.32-19.052-16.66-88.688-47.452-173.618 17.27-2.686 34.072-3.748 49.828-3.748 51.748 0 92.23 11.33 101.634 14.204-11.182 67.444-49.794 125.808-104.01 163.162z" fill="#D1D1D1" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Email" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon email-icon" viewBox="0 0 1024 1024" ariaLabelledby="email"><circle cx="512" cy="512" r="512" fill="#1384FF" />,<path d="M299.372 313.572H722.93c28.945 0 52.61 21.845 52.975 48.787L511.333 500.35 246.76 362.481c.182-27.003 23.666-48.97 52.611-48.97zm-52.671 101.702l-.243 244.121c0 27.186 23.848 49.395 52.914 49.395H722.93c29.127 0 52.975-22.21 52.975-49.395V415.152L517.522 546.71a13.957 13.957 0 01-12.682 0L246.7 415.274z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Evernote" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon evernote-icon" viewBox="0 0 1024 1024" ariaLabelledby="evernote"><circle cx="512" cy="512" r="512" fill="#36D613" />,<path d="M347.671 193.259v87.51h-87.51z" fill="#595757" />,<path d="M788.047 323.645s3.65-77.491-73.84-103.02c0 0-89.479-12.867-151.41-11.91 0 0-8.595-53.23-103.33-53.23 0 0-89.556-1.244-89.892 70.526v61.671s2.848 14.991-27.833 14.991h-81.581s-34.28 5.282-34.28 72.934c0 0 3.133 120.082 41.322 200.24 0 0 9.398 34.667 58.228 46.577 0 0 95.822 25.477 123.991 21.722 0 0 58.228 22.137 62.008-111.874 0 0 3.755-19.935 6.266 11.392 0 0-1.89 68.948 57.607 72.702 0 0 45.723 12.557 73.892 10.045 0 0 37.568 2.15 37.568 64.158 0 0 13.152 71.665-34.435 71.665h-65.763s-18.149 4.428-18.149-21.877c0 0-4.997-21.878 26.305-21.878h15.534v-43.756h-43.082s-66.332-6.317-66.332 50.047v75.135s9.347 49.866 66.332 49.866h121.273s48.441.44 76.61-90.359c0-.078 48.52-182.323 22.991-435.767zM625.272 486.523c0-21.877 18.02-51.16 39.432-51.16s36.48 36.118 36.48 58.022c-28.79-7.897-45.827-9.606-75.912-6.862z" fill="#595757" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Facebook" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon facebook-icon" viewBox="0 0 1024 1024" ariaLabelledby="facebook"><circle cx="512" cy="512" r="512" fill="#3C599B" />,<path d="M372.568 413.895h59.898V355.68c0-25.67.647-65.257 19.294-89.774 19.642-25.965 46.605-43.613 92.983-43.613 75.565 0 107.384 10.778 107.384 10.778l-14.971 88.74s-24.967-7.217-48.254-7.217c-23.302 0-44.16 8.35-44.16 31.635v67.666h95.526l-6.67 86.678h-88.855V801.69H432.466V500.574h-59.898v-86.68z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Flipboard" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon flipboard-icon" viewBox="0 0 1024 1024" ariaLabelledby="flipboard"><circle cx="512" cy="512" r="512" fill="#E12828" />,<path d="M293.58 292.18h160.343v481.003H293.58V292.18z" fill="#fff" />,<path d="M453.922 292.18h320.662v160.343H453.922V292.18z" fill="#FCE9E9" />,<path d="M453.922 452.523h160.343v160.343H453.922V452.523z" fill="#F6BEBE" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Gitee" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon gitee-icon" viewBox="0 0 1024 1024" ariaLabelledby="gitee"><circle cx="512" cy="512" r="512" fill="#C71D23" />,<path d="M772.953 454.723H480.17v.006a25.46 25.46 0 0 0-25.46 25.453l-.025 63.649a25.46 25.46 0 0 0 25.46 25.466l178.242-.007a25.46 25.46 0 0 1 25.459 25.46v12.73c0 42.18-34.198 76.378-76.378 76.378H365.583a25.46 25.46 0 0 1-25.46-25.46V416.533h-.006c0-42.18 34.192-76.378 76.378-76.378h356.388v-.013a25.46 25.46 0 0 0 25.46-25.446l.057-63.65h.013a25.46 25.46 0 0 0-25.46-25.471l-356.432.012c-105.453 0-190.946 85.493-190.946 190.946v356.433a25.46 25.46 0 0 0 25.46 25.46H626.56c94.913 0 171.852-76.94 171.852-171.852V480.182a25.46 25.46 0 0 0-25.46-25.46z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="GitHub" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" ariaLabelledby="github"><circle cx="512" cy="512" r="512" fill="#171515" />,<path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Gitlab" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon gitlab-icon" viewBox="0 0 1024 1024" ariaLabelledby="gitlab"><circle cx="512" cy="512" r="512" fill="#E8F0FF" />,<path d="m512 848.182 134.473-413.8H377.527L512 848.182z" fill="#E24329" />,<path d="m512 848.182-134.473-413.8h-188.36L512 848.182z" fill="#FC6D26" />,<path d="M189.167 434.382h188.36l-80.832-249.17c-4.202-12.854-22.247-12.854-26.45 0l-81.078 249.17z" fill="#E24329" />,<path d="m512 848.182 134.473-413.8h188.36L512 848.182z" fill="#FC6D26" />,<path d="m834.833 434.382 40.787 125.82a27.8 27.8 0 0 1-10.135 31.147L512 848.182l322.833-413.8z" fill="#FCA326" />,<path d="M834.833 434.382h-188.36l81.079-249.17c4.202-12.854 22.247-12.854 26.45 0l80.831 249.17z" fill="#E24329" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Gmail" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon gmail-icon" viewBox="0 0 1024 1024" ariaLabelledby="gmail"><circle cx="512" cy="512" r="512" fill="#DB4437" />,<path d="M277.48 285.567h465.767v441.362H277.48V285.567z" fill="#E67C73" />,<path d="M282.543 285.567h-10.645c-25.962 0-47.122 21.808-47.122 48.705v343.952c0 26.897 21.08 48.705 47.122 48.705h24.976V407.954l213.49 169.95 213.489-169.95V726.93h24.975c26.04 0 47.123-21.809 47.123-48.705V334.272c0-26.897-21.134-48.705-47.123-48.705h-10.644L510.364 480.44 282.542 285.567z" fill="#FFF" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Instagram" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon instagram-icon" viewBox="0 0 1024 1024" ariaLabelledby="instagram"><circle cx="512" cy="512" r="512" fill="#181818" />,<path d="M512 348.16c-88.222 0-163.84 71.417-163.84 163.84 0 88.222 71.417 163.84 163.84 163.84 88.222 0 163.84-71.417 163.84-163.84 0-88.222-75.618-163.84-163.84-163.84zm0 268.866c-58.814 0-105.026-46.212-105.026-105.026S453.186 406.974 512 406.974 617.026 453.186 617.026 512 570.814 617.026 512 617.026zM680.041 306.15c-21.005 0-37.81 16.804-37.81 37.809s16.805 37.81 37.81 37.81 37.81-16.805 37.81-37.81-16.805-37.81-37.81-37.81z" fill="#fff" />,<path d="M659.036 196.923h-16.804c-50.413-4.2-210.051-4.2-260.464 0-96.623-4.2-180.644 71.418-184.845 168.041v16.804c-4.2 50.413-4.2 210.051 0 260.464-4.2 96.623 71.418 180.644 168.041 184.845h16.804c50.413 4.2 210.051 4.2 260.464 0 96.623 4.2 180.644-71.418 184.845-168.041V381.768c4.2-96.623-71.418-180.644-168.041-184.845zM759.86 696.845c-12.604 29.407-33.609 50.412-58.815 58.814-121.83 16.805-247.86 16.805-373.891 0-29.407-12.603-50.412-33.608-58.814-58.814-12.604-63.015-16.805-126.03-12.604-184.845-4.2-63.015 0-126.03 12.604-184.845 12.603-29.407 33.608-50.412 58.814-58.814 121.83-16.805 247.86-16.805 373.891 0 29.407 12.603 50.412 33.608 58.815 58.814 12.603 63.015 16.804 126.03 12.603 184.845 4.2 63.015 0 126.03-12.603 184.845z" fill="#FFF" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Lines" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon lines-icon" viewBox="0 0 1024 1024" ariaLabelledby="lines"><circle cx="512" cy="512" r="512" fill="#00C300" />,<path d="M861.44 469.76C861.44 313.28 704 186.08 512 186.08s-349.44 127.2-349.44 283.68C162.56 608 286.88 727.52 454.88 752c11.52 2.4 26.88 7.68 30.72 17.28a71.04 71.04 0 0 1 0 31.68l-5.28 29.76c0 8.64-7.2 34.56 30.24 18.72a1104 1104 0 0 0 274.56-202.56A251.52 251.52 0 0 0 860 472.16zM375.2 562.88h-69.12a17.76 17.76 0 0 1-18.24-18.24v-139.2a17.76 17.76 0 0 1 18.24-18.24 18.24 18.24 0 0 1 18.24 18.24v120.48h50.88a18.72 18.72 0 0 1 18.24 18.72 18.24 18.24 0 0 1-18.24 18.24zm72-18.24a18.24 18.24 0 1 1-36.48 0v-139.2a18.24 18.24 0 0 1 36.48 0zm167.04 0a18.24 18.24 0 0 1-12.48 17.28H596a18.24 18.24 0 0 1-14.4-7.2l-69.6-96v85.92a18.24 18.24 0 1 1-36.48 0v-139.2A18.24 18.24 0 0 1 488 388.16h5.76a18.24 18.24 0 0 1 14.4 7.2l71.52 96v-85.92a18.24 18.24 0 1 1 36.48 0zm112.32-87.84a18.24 18.24 0 0 1 18.24 18.24 17.76 17.76 0 0 1-18.24 18.24h-50.88v32.64h50.88a18.72 18.72 0 0 1 18.24 18.72 18.24 18.24 0 0 1-18.24 18.24H656a18.24 18.24 0 0 1-18.24-18.24v-139.2A18.24 18.24 0 0 1 656 387.2h69.12a18.24 18.24 0 0 1 18.24 18.24 18.24 18.24 0 0 1-18.24 18.72h-49.44v32.64zm0 0" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Linkedin" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon linkedin-icon" viewBox="0 0 1024 1024" ariaLabelledby="linkedin"><circle cx="512" cy="512" r="512" fill="#4376B1" />,<path d="M838.301 555.94v225.157h-130.54V571.03c0-52.746-18.847-88.766-66.112-88.766-36.069 0-57.496 24.25-66.959 47.732-3.436 8.391-4.322 20.045-4.322 31.814v219.277h-130.55s1.752-355.784 0-392.613h130.56v55.637c-.263.438-.633.867-.867 1.285h.866v-1.285c17.349-26.694 48.287-64.856 117.651-64.856 85.884 0 150.273 56.114 150.273 176.685zm-535.05-356.72c-44.655 0-73.87 29.314-73.87 67.826 0 37.695 28.368 67.855 72.157 67.855h.847c45.532 0 73.842-30.16 73.842-67.855-.866-38.512-28.31-67.825-72.975-67.825zM237.14 781.098h130.5V388.474h-130.5v392.623z" fill="#F1F2F2" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Pinterest" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon pinterest-icon" viewBox="0 0 1024 1024" ariaLabelledby="pinterest"><path d="M512 1023.147c282.773 0 512-228.288 512-509.888 0-281.622-229.227-509.91-512-509.91S0 231.637 0 513.26c0 281.6 229.227 509.888 512 509.888z" fill="#fff" />,<path d="M512 3.35C229.248 3.35 0 231.658 0 513.258c0 216.128 134.848 400.789 325.312 475.05-4.63-40.277-8.427-102.378 1.685-146.453 9.28-39.872 59.84-253.483 59.84-253.483s-15.168-30.634-15.168-75.541c0-70.933 41.302-123.797 92.715-123.797 43.819 0 64.896 32.725 64.896 71.765 0 43.627-27.819 109.099-42.56 169.963-12.224 50.773 25.707 92.33 75.84 92.33 91.03 0 160.981-95.68 160.981-233.344 0-122.133-88.064-207.317-214.058-207.317-145.814 0-231.36 108.693-231.36 221.163 0 43.648 16.853 90.645 37.93 116.245a15.19 15.19 0 0 1 3.371 14.699c-3.797 15.936-12.65 50.773-14.336 57.92-2.09 9.216-7.573 11.328-17.28 6.698-64.043-29.781-104.085-122.538-104.085-197.653 0-160.747 117.162-308.459 338.389-308.459 177.408 0 315.627 125.888 315.627 294.614 0 175.829-111.254 317.269-265.472 317.269-51.84 0-100.715-26.859-117.163-58.752l-32.021 121.28c-11.371 44.48-42.56 99.883-63.638 133.867A516.01 516.01 0 0 0 511.168 1024c282.752 0 512-228.31 512-509.91C1024 231.66 794.752 3.35 512 3.35z" fill="#CA242D" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Pocket" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon pocket-icon" viewBox="0 0 1024 1024" ariaLabelledby="pocket"><circle cx="512" cy="512" r="512" fill="#EE4056" />,<path d="M716.52 309.066c12.549 0 23.172 4.394 31.87 13.182 8.697 8.788 13.023 19.48 13.023 32.006v150.4c0 33.975-6.568 66.41-19.705 97.307-13.138 30.918-30.76 57.487-52.89 79.685-22.106 22.197-48.562 39.864-79.367 52.888-30.804 13.024-63.081 19.547-96.876 19.547a246.897 246.897 0 0 1-97.215-19.547c-30.805-13.046-57.306-30.668-79.504-52.888-22.198-22.198-39.865-48.767-53.003-79.663a246.311 246.311 0 0 1-19.728-97.33V354.255c0-12.321 4.44-22.945 13.319-31.847a43.489 43.489 0 0 1 31.87-13.341H716.52zM512.574 617.339c9.06 0 16.989-3.216 23.738-9.581l117.103-112.415a32.622 32.622 0 0 0 10.691-24.62c0-9.469-3.33-17.533-9.966-24.191a32.958 32.958 0 0 0-24.237-10.012c-9.06 0-16.988 3.171-23.737 9.56l-93.547 89.808-93.614-89.809a33.185 33.185 0 0 0-23.443-9.559c-9.468 0-17.532 3.33-24.19 9.967-6.66 6.682-9.967 14.722-9.967 24.236 0 9.83 3.443 18.03 10.419 24.599l117.33 112.413c6.342 6.342 14.179 9.56 23.466 9.56l-.046.044z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="QQ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon qq-icon" viewBox="0 0 1024 1024" ariaLabelledby="qq"><circle cx="512" cy="512" r="512" fill="#5EAADE" />,<path d="M729.46 627.3c-3.157-39.628-24.045-83.747-32.624-105.91l-22.084-57.047c-.702-23.73 6.312-78.322-30.511-146.61s-110.82-74.446-124.497-75.147c-13.677-.701-99.248-1.403-141.331 72.945-42.084 74.347-30.745 148.812-30.745 148.812l-23.523 57.478c-.001.002-10.962 26.223-20.43 58.135-9.469 31.914-18.938 82.064-9.469 92.234 9.47 10.17 43.837-46.643 46.993-51.903 0 0 2.456 27.18 8.943 41.383l.81 1.776.33.723.38.826.3.652.444.96.203.436a281.465 281.465 0 0 0 1.917 4.025l.189.386c.231.473.468.953.711 1.442l.146.292c6.886 13.807 18.61 33.823 37.443 50.42l.018.016-1.184.387c-10.667 3.516-31.694 11.21-40.625 19.82-1.717 1.655-2.987 3.344-3.65 5.045-5.376 13.794 4.208 15.43 20.575 16.366 16.366.934 94.923 3.04 132.564-2.221.407-.056.787-.114 1.17-.171 2.711.094 5.324.142 7.83.16l.151.002c.836.005 1.663.008 2.475.008.496 0 1.015-.002 1.542-.006l.21-.001a222.593 222.593 0 0 0 5.462-.107c.26.038.508.076.778.114 37.642 5.26 116.198 3.156 132.564 2.22 16.366-.934 25.951-2.571 20.574-16.365-4.302-11.037-34.175-21.62-45.956-25.413a141.388 141.388 0 0 0 7.958-7.645l.237-.245a142.494 142.494 0 0 0 2.53-2.702c42.435-46.643 38.928-76.101 40.682-92.935 0 0 35.775 51.553 43.488 53.306 7.713 1.754 10.169-6.31 7.012-45.94z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Qzone" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon qzone-icon" viewBox="0 0 1024 1024" ariaLabelledby="qzone"><circle cx="512" cy="512" r="512" fill="#0985DD" />,<path d="M722.38 595.24c22.486-4.056 11.345-12.424 2.156-11.346-16.685 1.72-40.43 1.925-66.562 1.284l3.029 17.79a656.641 656.641 0 0 0 61.402-7.702l-.025-.026zm68.95-174.915a5.287 5.287 0 0 0-4.493-3.645L598.42 389.29l-84.326-170.628c-1.925-3.594-7.958-3.594-9.857 0L419.885 389.29l-188.417 27.39a5.338 5.338 0 0 0-4.466 3.645 5.493 5.493 0 0 0 1.488 5.57l136.36 132.92-32.088 187.519a5.263 5.263 0 0 0 2.13 5.39c1.695 1.284 3.851 1.463 5.776.385l168.651-88.407 168.524 88.638 2.567.642 3.209-1.079c1.72-1.283 2.566-3.208 2.13-5.34l-24.591-143.648c-27.21 2.156-54.37 3.183-76.42 3.183-77.267 0-135.075-3.645-135.948-3.645a16.48 16.48 0 0 1-14.785-11.757 16.247 16.247 0 0 1 5.981-17.764l155.431-113.05c-99.959-7.906-183.873-6.418-184.721-6.418-13.502.642-25.67-3.645.642-14.375 4.518-1.694 109.2-23.72 230.362-7.445 6.673.847 12.013 5.75 13.733 12.194a16.61 16.61 0 0 1-6.263 17.302L497.204 571.598c27.826 5.802 100.37 12.014 160.745 13.502l-4.519-26.312 136.308-132.97a5.338 5.338 0 0 0 1.54-5.544l.051.051z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Reddit" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon reddit-icon" viewBox="0 0 1024 1024" ariaLabelledby="reddit"><circle cx="512" cy="512" r="512" fill="#EB5528" />,<path d="M617.199 680.55c5.666 5.974 5.666 11.742 0 17.34-21.845 23.143-56.9 34.714-105.199 34.714s-83.354-11.571-105.199-34.714c-5.666-5.598-5.666-11.366 0-17.34a10.445 10.445 0 0 1 7.919-3.379c3.174 0 5.803 1.127 7.919 3.38 16.93 18.295 46.728 27.408 89.361 27.408 42.325 0 72.09-9.113 89.361-27.409a10.445 10.445 0 0 1 7.919-3.379c3.174 0 5.803 1.127 7.919 3.38zm-176.06-136.635c9.182 9.694 13.756 21.47 13.756 35.294 0 13.79-4.574 25.565-13.756 35.26a44.134 44.134 0 0 1-33.28 14.54c-13.073 0-24.234-4.847-33.587-14.54a49.015 49.015 0 0 1-13.995-35.26c0-14.2 4.642-26.147 13.995-35.84 9.353-9.728 20.514-14.575 33.587-14.575 13.04 0 24.132 5.051 33.28 15.12zm222.584 35.294c0 13.79-4.642 25.565-13.995 35.26a44.954 44.954 0 0 1-33.587 14.54c-13.04 0-24.132-4.847-33.28-14.54a49.493 49.493 0 0 1-13.756-35.26c0-13.824 4.574-25.669 13.756-35.567 9.148-9.9 20.24-14.848 33.28-14.848 13.073 0 24.234 4.847 33.587 14.575 9.353 9.693 13.995 21.64 13.995 35.84zM796.433 512c0-18.295-6.144-33.963-18.5-47.036a59.494 59.494 0 0 0-44.92-19.592c-17.647 0-32.768 6.724-45.465 20.138-45.841-33.587-100.66-51.507-164.455-53.725l33.314-158.482 105.746 25.19c0 13.825 4.573 25.6 13.755 35.295 9.148 9.694 20.241 14.54 33.314 14.54 13.04 0 24.235-4.915 33.553-14.813 9.353-9.899 13.995-21.743 13.995-35.567s-4.642-25.669-13.995-35.567a44.578 44.578 0 0 0-33.553-14.814c-19.046 0-33.143 9.318-42.325 27.99L550.06 228.112c-6.69-1.877-11.094 1.126-13.21 8.977l-36.488 174.695c-63.454 2.594-117.897 20.718-163.363 54.272a59.187 59.187 0 0 0-46.011-20.685c-17.613 0-32.598 6.52-44.92 19.592a66.082 66.082 0 0 0-18.5 47.036c0 13.073 3.243 25.02 9.762 35.84 6.52 10.82 15.258 19.046 26.18 24.644a152.303 152.303 0 0 0-3.174 31.335c0 53.009 24.678 98.372 74.035 136.09 49.323 37.682 108.715 56.524 178.176 56.524 69.769 0 129.365-18.842 178.688-56.525 49.357-37.717 74.001-83.08 74.001-136.09 0-11.946-1.229-22.561-3.686-31.914 10.581-5.598 19.046-13.722 25.395-24.337 6.315-10.65 9.49-22.528 9.49-35.567z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Rss" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon rss-icon" viewBox="0 0 1024 1024" ariaLabelledby="rss"><circle cx="512" cy="512" r="512" fill="#FD9B00" />,<path d="M687.981 740.39c0-225.92-183.617-409.777-409.21-409.777v-97.205c279.353 0 506.617 227.506 506.617 506.98H687.98zm-74.841 0h-97.538c0-63.567-24.688-123.245-69.43-167.993-44.762-44.856-104.24-69.556-167.54-69.556v-97.176c184.44 0 334.508 150.046 334.508 334.725zM346.038 605.166c37.35 0 67.514 30.357 67.514 67.39 0 37.146-30.163 67.177-67.514 67.177-37.219 0-67.458-30.03-67.458-67.176 0-37.034 30.24-67.391 67.458-67.391z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Steam" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon steam-icon" viewBox="0 0 1024 1024" ariaLabelledby="steam"><circle cx="512" cy="512" r="488" fill="#fff" />,<path d="M1008 512c0 274-222.4 496-496.8 496-227.6 0-419.2-152.6-478-360.8l190.4 78.6c12.8 64.2 69.8 112.8 137.8 112.8 78.4 0 143.8-64.8 140.4-147l169-120.4c104.2 2.6 191.6-81.8 191.6-187 0-103.2-84-187-187.4-187s-187.4 84-187.4 187v2.4L369.2 558c-31-1.8-61.4 6.8-87 24.2L16 472.2C36.4 216.8 250.2 16 511.2 16 785.6 16 1008 238 1008 512zM327.4 768.6l-61-25.2a105.58 105.58 0 0 0 54.4 51.6c53.8 22.4 115.6-3.2 138-56.8 10.8-26 11-54.6.2-80.6-10.8-26-31-46.4-57-57.2-25.8-10.8-53.4-10.4-77.8-1.2l63 26c39.6 16.4 58.4 61.8 41.8 101.4-16.6 39.8-62 58.4-101.6 42zM675 508.8c-68.8 0-124.8-56-124.8-124.6s56-124.6 124.8-124.6 124.8 56 124.8 124.6S744 508.8 675 508.8zm.2-31.2c51.8 0 93.8-42 93.8-93.6 0-51.8-42-93.6-93.8-93.6s-93.8 42-93.8 93.6c.2 51.6 42.2 93.6 93.8 93.6z" fill="#13227a" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Twitter" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon twitter-icon" viewBox="0 0 1024 1024" ariaLabelledby="twitter"><circle cx="512" cy="512" r="512" fill="#5EAADE" />,<path d="M749.737 364.631c-17.594 7.805-36.513 13.088-56.371 15.459 20.269-12.148 35.836-31.387 43.156-54.312A196.233 196.233 0 0 1 674.2 349.6c-17.894-19.083-43.406-30.997-71.636-30.997-54.2 0-98.137 43.944-98.137 98.157 0 7.695.861 15.19 2.544 22.373-81.57-4.092-153.876-43.174-202.284-102.558-8.443 14.498-13.285 31.356-13.285 49.348 0 34.05 17.326 64.096 43.656 81.697a97.69 97.69 0 0 1-44.447-12.277c-.01.41-.01.82-.01 1.24 0 47.558 33.822 87.23 78.72 96.249a98.285 98.285 0 0 1-25.852 3.448 97.491 97.491 0 0 1-18.465-1.768c12.483 39.002 48.725 67.38 91.672 68.17-33.582 26.334-75.897 42.024-121.884 42.024-7.924 0-15.736-.46-23.408-1.37 43.434 27.844 95.014 44.104 150.443 44.104 180.505 0 279.221-149.576 279.221-279.294 0-4.263-.09-8.494-.278-12.708 19.178-13.835 35.813-31.115 48.967-50.807z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Wechat" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon wechat-icon" viewBox="0 0 1024 1024" ariaLabelledby="wechat"><circle cx="512" cy="512" r="512" fill="#1AC88E" />,<path d="M827.551 578.742a176.583 176.583 0 0 0-185.685-158.379 172.942 172.942 0 0 0-186.3 158.379 172.942 172.942 0 0 0 185.686 158.379 282.169 282.169 0 0 0 65.536-10.923l60.689 32.768-16.384-54.613a166.275 166.275 0 0 0 76.458-125.611zm-245.76-27.307a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.307 21.845 24.872 24.872 0 0 1-27.921 21.845h.614zm121.356 0a21.845 21.845 0 1 1 0-43.69 24.872 24.872 0 0 1 27.306 21.845 24.872 24.872 0 0 1-28.512 21.845h1.206z" fill="#fff" />,<path d="M623.662 400.953h21.23A222.709 222.709 0 0 0 419.772 245.6a208.145 208.145 0 0 0-223.323 189.94 182.044 182.044 0 0 0 89.201 150.483l-22.436 67.356 78.279-39.435a389.575 389.575 0 0 0 78.279 10.923h20.616a163.226 163.226 0 0 1-6.667-46.718 182.044 182.044 0 0 1 189.94-177.197zm-121.379-60.69a27.921 27.921 0 1 1 0 55.843 31.562 31.562 0 0 1-33.36-27.921 31.562 31.562 0 0 1 34.59-27.921h-1.23zM346.34 396.107a31.562 31.562 0 0 1-33.383-27.921 31.562 31.562 0 0 1 33.383-27.921 27.921 27.921 0 1 1 0 55.842z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Weibo" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon weibo-icon" viewBox="0 0 1024 1024" ariaLabelledby="weibo"><circle cx="512" cy="512" r="512" fill="#E6162D" />,<path d="M745.314 454.802c9.652 0 17.869-7.258 19.239-16.728a8.39 8.39 0 0 0 .261-2.12C779.445 302.233 657.02 325.25 657.02 325.25c-10.869 0-19.567 8.94-19.567 20.089 0 10.97 8.698 19.907 19.567 19.907 87.95-19.732 68.54 69.649 68.54 69.649-.004 11.06 8.842 19.908 19.754 19.908z" fill="#fff" />,<path d="M731.054 221.409c-42.342-10.077-85.862-1.393-98.055.981-.938.09-1.829.994-2.697 1.17-.415.088-.673.532-.673.532-12.045 3.457-20.828 14.77-20.828 28.14 0 15.932 12.694 29.034 28.564 29.034 0 0 15.39-2.097 25.846-6.252 10.364-4.246 98.012-3.16 141.576 71.17 23.734 54.247 10.428 90.553 8.778 96.387 0 0-5.653 14.095-5.653 27.973 0 16.024 12.694 26.083 28.433 26.083 13.169 0 24.211-1.821 27.452-24.447h.172c46.768-158.386-57.183-232.81-132.915-250.771zm-44.083 282.78c-28.28-5.579-14.519-21.062-14.519-21.062s27.67-46.38-5.482-80.099c-41.104-41.761-140.966 5.314-140.966 5.314-38.144 12.032-28.02-5.49-22.629-35.31 0-35.13-11.844-94.596-113.445-59.47-101.49 35.309-188.654 159.03-188.654 159.03-60.603 82.207-52.56 145.747-52.56 145.747 15.128 140.268 161.749 178.772 275.782 187.89 119.967 9.564 281.905-42.045 330.988-148.064 49.105-106.193-40.126-148.22-68.515-153.975zM433.387 766.675c-119.124 5.658-215.394-55.053-215.394-135.851 0-80.887 96.27-145.748 215.394-151.328 119.162-5.58 215.634 44.333 215.634 125.052.002 80.79-96.475 156.626-215.634 162.127z" fill="#fff" />,<path d="M409.603 532.773c-119.77 14.249-105.943 128.31-105.943 128.31s-1.22 36.117 32.126 54.513c70.084 38.593 142.248 15.224 178.723-32.634 36.474-47.888 15.086-164.346-104.906-150.189zM379.39 692.856c-22.343 2.665-40.385-10.437-40.385-29.463 0-18.94 16.02-38.768 38.387-41.143 25.694-2.485 42.431 12.56 42.431 31.588-.003 18.936-18.128 36.449-40.433 39.018zm70.626-61.146c-7.59 5.754-16.893 4.958-20.892-1.948-4.175-6.726-2.607-17.52 5.046-23.19 8.863-6.714 18.105-4.779 22.106 1.958 4.02 6.893 1.153 17.246-6.26 23.18z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Whatsapp" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon whatsapp-icon" viewBox="0 0 1024 1024" ariaLabelledby="whatsapp"><circle cx="512" cy="512" r="512" fill="#31B84C" />,<path d="m192.021 832 45.227-164.33a315.413 315.413 0 0 1-42.539-158.529C194.731 334.251 337.707 192 513.344 192c84.587-.213 165.76 33.28 225.387 93.013A314.453 314.453 0 0 1 832 509.376c-.085 174.848-143.04 317.141-318.656 317.141h-.15a319.61 319.61 0 0 1-152.277-38.613L192 832h.021zm241.686-455.467c-6.443-15.445-13.014-13.354-17.92-13.61-4.63-.214-9.942-.256-15.254-.256a29.227 29.227 0 0 0-21.226 9.898c-7.296 7.958-27.84 27.136-27.84 66.134s28.501 76.672 32.49 81.962c3.968 5.291 56.15 85.334 136 119.638 19.008 8.17 33.814 13.056 45.398 16.704 19.072 6.037 36.437 5.184 50.133 3.157 15.296-2.283 47.125-19.2 53.76-37.675 6.613-18.56 6.613-34.389 4.65-37.717-1.983-3.264-7.295-5.27-15.274-9.237-7.957-3.947-47.125-23.126-54.4-25.771-7.296-2.667-12.587-3.968-17.92 3.947-5.312 7.936-20.565 25.792-25.195 31.061-4.65 5.312-9.301 5.973-17.258 2.005-7.979-3.968-33.622-12.33-64-39.338-23.68-20.992-39.68-46.955-44.331-54.912-4.65-7.915-.47-12.203 3.52-16.15 3.563-3.541 7.936-9.258 11.904-13.866 3.99-4.651 5.333-7.958 7.979-13.227 2.645-5.29 1.322-9.92-.64-13.888-2.006-3.968-17.92-42.987-24.555-58.859h-.021z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Youtube" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon youtube-icon" viewBox="0 0 1024 1024" ariaLabelledby="youtube"><circle cx="512" cy="512" r="512" fill="#DD1829" />,<path d="M800.305 372.2c-12.805-42.429-22.873-65.942-65.303-71.064 0 0-113.644-5.761-226.64-5.761-111.716 0-222.797 5.761-222.797 5.761-44.992 5.122-55.7 29.915-67.223 71.065 0 0-11.524 65.527-11.524 131.886 0 68.066 11.524 137.008 11.524 137.008 8.963 39.87 27.354 65.943 67.223 71.065 0 0 123.292 7.682 240.724 7.682 106.78 0 208.714-7.682 208.714-7.682 39.87-7.682 53.78-28.635 65.303-71.065 0 0 11.523-63.022 11.523-128.045 0-69.288-11.524-140.85-11.524-140.85zM448.82 619.97V393.33l174.781 113.32L448.82 619.97z" fill="#fff" /></svg></a><a class="social-media" href="https://example.com" rel="noopener noreferrer" target="_blank" aria-label="Zhihu" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon zhihu-icon" viewBox="0 0 1024 1024" ariaLabelledby="zhihu"><circle cx="512" cy="512" r="512" fill="#006CE2" />,<path d="M513.65 491.261H411.551c1.615-16.154 5.815-60.095 5.815-84.973 0-24.88-.323-60.742-.323-60.742h102.744V329.39c0-21.647-9.37-31.34-17.124-31.34h-178.67s5.169-17.77 10.015-36.186c4.846-18.417 15.832-44.264 15.832-44.264-63.003 4.2-67.958 50.941-81.743 92.729-13.787 41.785-24.556 62.356-44.586 107.912 27.786 0 55.249-13.57 66.879-32.309 11.631-18.74 16.908-40.71 16.908-40.71h62.035v59.019c0 21.107-3.878 87.45-3.878 87.45H254.742c-19.386 0-29.724 48.894-29.724 48.894h133.76c-8.4 75.82-26.493 106.191-51.91 152.716-25.418 46.525-92.728 99.406-92.728 99.406 41.033 11.63 86.589-3.555 105.974-21.972 19.386-18.417 35.863-49.756 47.817-72.838 11.954-23.081 21.972-65.124 21.972-65.124L498.462 766.86s4.846-24.233 6.461-39.418c1.616-15.186-.755-26.385-4.63-35.433-3.878-9.046-15.509-21.54-31.018-39.634-15.507-18.094-48.034-52.879-48.034-52.879s-15.832 11.63-28.108 21.001c9.046-21.97 16.262-79.695 16.262-79.695h122.343v-20.249c.003-17.66-7.319-29.29-18.089-29.29zm287.337-200.747h-234.35a4.308 4.308 0 0 0-4.309 4.308v435.099a4.308 4.308 0 0 0 4.308 4.308h40.226l14.7 50.402 81.096-50.402h98.328a4.308 4.308 0 0 0 4.308-4.308v-435.1a4.308 4.308 0 0 0-4.308-4.308zM755.97 684.47h-52.343l-61.548 39.095-10.823-39.095h-18.738V338.116H755.97v346.355z" fill="#fff" /></svg></a></div></div><!--]--><!----><!--]--><!--[--><!--[--><div class="category-card" data-v-9c09ffbc><header class="category-card-title" data-v-9c09ffbc>博客分类</header><ul class="category-list" data-v-9c09ffbc><!--[--><li class="category-item category0" data-v-9c09ffbc><a href="/category/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>使用指南</span><span class="category-number" data-v-9c09ffbc>6</span></a></li><li class="category-item category1" data-v-9c09ffbc><a href="/category/markdown/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Markdown</span><span class="category-number" data-v-9c09ffbc>8</span></a></li><li class="category-item category2" data-v-9c09ffbc><a href="/category/%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%93%8D%E4%BD%9C/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>服务器操作</span><span class="category-number" data-v-9c09ffbc>14</span></a></li><li class="category-item category3" data-v-9c09ffbc><a href="/category/mysql/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Mysql</span><span class="category-number" data-v-9c09ffbc>2</span></a></li><li class="category-item category4" data-v-9c09ffbc><a href="/category/nginx/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Nginx</span><span class="category-number" data-v-9c09ffbc>2</span></a></li><li class="category-item category5" data-v-9c09ffbc><a href="/category/vite/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Vite</span><span class="category-number" data-v-9c09ffbc>1</span></a></li><li class="category-item category6" data-v-9c09ffbc><a href="/category/%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>组件开发</span><span class="category-number" data-v-9c09ffbc>1</span></a></li><li class="category-item category7" data-v-9c09ffbc><a href="/category/javascript/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>JavaScript</span><span class="category-number" data-v-9c09ffbc>1</span></a></li><li class="category-item category8" data-v-9c09ffbc><a href="/category/canvas/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Canvas</span><span class="category-number" data-v-9c09ffbc>1</span></a></li><li class="category-item category0" data-v-9c09ffbc><a href="/category/vuepress/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Vuepress</span><span class="category-number" data-v-9c09ffbc>1</span></a></li><li class="category-item category1" data-v-9c09ffbc><a href="/category/centos7/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Centos7</span><span class="category-number" data-v-9c09ffbc>2</span></a></li><li class="category-item category2" data-v-9c09ffbc><a href="/category/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>文件系统</span><span class="category-number" data-v-9c09ffbc>1</span></a></li><li class="category-item category3" data-v-9c09ffbc><a href="/category/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>定时任务</span><span class="category-number" data-v-9c09ffbc>1</span></a></li><li class="category-item category4" data-v-9c09ffbc><a href="/category/php/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Php</span><span class="category-number" data-v-9c09ffbc>6</span></a></li><li class="category-item category5" data-v-9c09ffbc><a href="/category/%E6%95%99%E7%A8%8B%E7%9F%A5%E8%AF%86/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>教程知识</span><span class="category-number" data-v-9c09ffbc>7</span></a></li><li class="category-item category6" data-v-9c09ffbc><a href="/category/node/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Node</span><span class="category-number" data-v-9c09ffbc>4</span></a></li><li class="category-item category7" data-v-9c09ffbc><a href="/category/koa/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Koa</span><span class="category-number" data-v-9c09ffbc>3</span></a></li><li class="category-item category8" data-v-9c09ffbc><a href="/category/typescript/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Typescript</span><span class="category-number" data-v-9c09ffbc>3</span></a></li><li class="category-item category0" data-v-9c09ffbc><a href="/category/javascript/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Javascript</span><span class="category-number" data-v-9c09ffbc>1</span></a></li><li class="category-item category1" data-v-9c09ffbc><a href="/category/spl/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Spl</span><span class="category-number" data-v-9c09ffbc>1</span></a></li><li class="category-item category2" data-v-9c09ffbc><a href="/category/vue3/" class="" data-v-9c09ffbc><span class="category-title" data-v-9c09ffbc>Vue3</span><span class="category-number" data-v-9c09ffbc>3</span></a></li><!--]--></ul></div><!--]--><!----><!--]--><!--[--><!--[--><div class="blog-info-list"><div class="switch-wrapper"><!--[--><button class="switch-button"><div class="icon-wapper active" aria-label="文章"><svg xmlns="http://www.w3.org/2000/svg" class="icon article-icon" viewbox="0 0 1024 1024" arialabelledby="article"><title id="article" lang="en">article icon</title><g fill="currentColor"><path d="M853.333 938.667H170.667A42.667 42.667 0 0 1 128 896V128a42.667 42.667 0 0 1 42.667-42.667h682.666A42.667 42.667 0 0 1 896 128v768a42.667 42.667 0 0 1-42.667 42.667zm-42.666-85.334V170.667H213.333v682.666h597.334zM298.667 256h170.666v170.667H298.667V256zm0 256h426.666v85.333H298.667V512zm0 170.667h426.666V768H298.667v-85.333zm256-384h170.666V384H554.667v-85.333z"></path></g></svg></div></button><button class="switch-button"><div class="icon-wapper" aria-label="标签"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg></div></button><button class="switch-button"><div class="icon-wapper" aria-label="时间轴"><svg xmlns="http://www.w3.org/2000/svg" class="icon timeline-icon" viewbox="0 0 1024 1024" arialabelledby="timeline"><title id="timeline" lang="en">timeline icon</title><g fill="currentColor"><path d="M511.997 70.568c-243.797 0-441.429 197.633-441.429 441.435 0 243.797 197.632 441.429 441.43 441.429S953.431 755.8 953.431 512.002c0-243.796-197.637-441.434-441.435-441.434zm150.158 609.093-15.605 15.61c-8.621 8.615-22.596 8.615-31.215 0L472.197 552.126c-4.95-4.944-4.34-14.888-4.34-24.677V247.14c0-12.19 9.882-22.07 22.07-22.07h22.07c12.19 0 22.07 9.882 22.07 22.07v273.218l128.088 128.088c8.62 8.62 8.62 22.595 0 31.215zm0 0"></path></g></svg></div></button><!--]--></div><!--[--><!--[--><div class="sticky-article-wrapper"><div class="title"><svg xmlns="http://www.w3.org/2000/svg" class="icon article-icon" viewbox="0 0 1024 1024" arialabelledby="article"><title id="article" lang="en">article icon</title><g fill="currentColor"><path d="M853.333 938.667H170.667A42.667 42.667 0 0 1 128 896V128a42.667 42.667 0 0 1 42.667-42.667h682.666A42.667 42.667 0 0 1 896 128v768a42.667 42.667 0 0 1-42.667 42.667zm-42.666-85.334V170.667H213.333v682.666h597.334zM298.667 256h170.666v170.667H298.667V256zm0 256h426.666v85.333H298.667V512zm0 170.667h426.666V768H298.667v-85.333zm256-384h170.666V384H554.667v-85.333z"></path></g></svg><span class="num">41</span> 文章</div><hr><ul class="sticky-article-list"><!--[--><!--[--><!--[--><li class="sticky-article">页面配置</li><!--]--><!----><!--]--><!--]--></ul></div><!--]--><!----><!--]--><!----><!----></div><!--]--><!----><!--]--></aside><!--]--><!----><!--]--></div></div></div><!--]--><footer class="footer-container"><div class="footer-content"><div class="footer-logo">CavinHuang</div><div class="footer-center"></div><div class="footer-right"><div class="contact-item"><img src="" alt=""></div></div></div><div class="footer"><!----><a href="https://beian.miit.gov.cn">粤ICP备2022100010号-1</a><div style="width:300px;margin:0 auto;padding:20px 0;"><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44030602007137" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="https://www.beian.gov.cn/img/ghs.png" style="float:left;"><p style="float:left;height:20px;line-height:20px;margin:0px 0px 0px 5px;color:#939393;">粤公网安备 44030602007137号</p></a></div></div></footer></div></div><!--]--></div>
    <script type="module" src="/assets/app.f3af98d4.js" defer></script>
  </body>
</html>
